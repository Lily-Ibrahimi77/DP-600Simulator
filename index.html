<!doctype html>
<html lang="sv">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DP-600: The Atlas Protocol Ultimate</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&family=JetBrains+Mono:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #09090b;
        color: #e4e4e7;
        overflow-x: hidden;
      }
      .glass-panel {
        background: rgba(24, 24, 27, 0.85);
        backdrop-filter: blur(16px);
        border: 1px solid rgba(255, 255, 255, 0.08);
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.2);
      }
      .phone-frame {
        width: 360px;
        height: 650px;
        background-color: #18181b;
        border-radius: 30px;
        position: relative;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        border: 1px solid #27272a;
        transition: all 0.3s ease;
      }
      .phone-frame:hover {
        border-color: #d97706;
        transform: translateY(-2px);
        box-shadow: 0 10px 40px -10px rgba(217, 119, 6, 0.2);
      }

      /* --- CODE BLOCKS (UPDATED FIX) --- */
      code {
        font-family: "JetBrains Mono", monospace;
        background: #000;
        padding: 2px 4px;
        border-radius: 4px;
        color: #fcd34d;
        font-size: 0.8em;
        word-break: break-word;
      }

      pre {
        background: #0c0a09;
        padding: 12px;
        border-radius: 8px;
        border: 1px solid #292524;
        overflow-x: auto;
        font-family: "JetBrains Mono", monospace;
        font-size: 0.75rem;
        color: #a8a29e;
        margin-bottom: 12px;
        white-space: pre-wrap;
        word-break: break-all;
        max-width: 100%;
      }

      /* --- CHEAT SHEET STYLES --- */
      .cheat-table th {
        font-size: 0.75rem;
        letter-spacing: 0.05em;
        color: #a1a1aa;
        font-weight: 700;
        padding: 12px;
        border-bottom: 1px solid #27272a;
      }
      .cheat-table td {
        padding: 12px;
        border-bottom: 1px solid #27272a;
        font-size: 0.9rem;
        vertical-align: top;
      }
      .cheat-table tr:last-child td {
        border-bottom: none;
      }
      .cheat-scenario {
        font-weight: 500;
        color: #e4e4e7;
      }
      .cheat-solution {
        color: #fcd34d;
        font-family: "JetBrains Mono", monospace;
        font-weight: 700;
      }
      .cheat-logic {
        color: #d6d3d1;
        font-style: italic;
        font-size: 0.85rem;
      }

      /* --- CODEX STYLES --- */
      .codex-card {
        background-color: #18181b;
        border: 1px solid #27272a;
        border-radius: 16px;
        padding: 32px;
        margin-bottom: 32px;
        transition: all 0.2s ease;
      }
      .codex-card:hover {
        border-color: #fbbf24;
        box-shadow: 0 0 20px rgba(251, 191, 36, 0.05);
      }
      .boring-def {
        border-left: 2px solid #52525b;
        padding-left: 16px;
        color: #a1a1aa;
        font-size: 0.95rem;
        margin-bottom: 16px;
        font-style: italic;
        line-height: 1.6;
      }
      .atlas-trans {
        background: linear-gradient(to right, #2a1b0e, #18181b);
        border-left: 4px solid #d97706;
        padding: 20px;
        border-radius: 0 12px 12px 0;
        color: #fbbf24;
        font-weight: 500;
        line-height: 1.6;
        position: relative;
      }
      .atlas-label {
        position: absolute;
        top: -10px;
        left: 16px;
        background: #d97706;
        color: black;
        font-size: 0.65rem;
        font-weight: 900;
        padding: 2px 8px;
        border-radius: 4px;
        text-transform: uppercase;
        letter-spacing: 0.1em;
      }

      /* Chat */
      .chat-container {
        height: 600px;
        display: flex;
        flex-direction: column;
        background: #18181b;
        border-radius: 16px;
        border: 1px solid #27272a;
        overflow: hidden;
      }
      .chat-messages {
        flex-grow: 1;
        padding: 20px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 16px;
      }
      .chat-input-area {
        padding: 16px;
        background: #27272a;
        display: flex;
        gap: 10px;
        border-top: 1px solid #3f3f46;
      }
      .msg {
        padding: 12px 16px;
        border-radius: 12px;
        max-width: 80%;
        font-size: 0.9rem;
        line-height: 1.5;
        word-wrap: break-word;
      }
      .msg-user {
        align-self: flex-end;
        background: #2a1b0e;
        border: 1px solid #d97706;
        color: white;
      }
      .msg-ai {
        align-self: flex-start;
        background: #27272a;
        border: 1px solid #3f3f46;
        color: #d4d4d8;
      }
      .typing-dot {
        display: inline-block;
        width: 6px;
        height: 6px;
        background: #d4d4d8;
        border-radius: 50%;
        margin: 0 2px;
        animation: bounce 1.4s infinite ease-in-out both;
      }
      .typing-dot:nth-child(1) {
        animation-delay: -0.32s;
      }
      .typing-dot:nth-child(2) {
        animation-delay: -0.16s;
      }
      @keyframes bounce {
        0%,
        80%,
        100% {
          transform: scale(0);
        }
        40% {
          transform: scale(1);
        }
      }

      /* Options */
      .option-btn {
        width: 100%;
        text-align: left;
        background-color: #27272a;
        border: 1px solid #3f3f46;
        padding: 12px;
        margin-bottom: 8px;
        border-radius: 10px;
        font-size: 0.85rem;
        color: #d4d4d8;
        transition: all 0.1s;
        display: flex;
        align-items: flex-start;
        cursor: pointer;
        font-family: "JetBrains Mono", monospace;
      }

      .option-btn span {
        flex: 1;
        min-width: 0;
        word-wrap: break-word;
        word-break: break-word;
        white-space: normal;
      }
      .option-btn:hover {
        background-color: #3f3f46;
        transform: scale(1.02);
      }
      .option-btn:active {
        transform: scale(0.98);
      }
      .option-circle {
        width: 20px;
        height: 20px;
        background-color: #52525b;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 0.7rem;
        margin-right: 12px;
        flex-shrink: 0;
        font-family: "Inter", sans-serif;
        margin-top: 2px;
      }
      .correct-answer {
        background-color: #065f46 !important;
        border-color: #10b981 !important;
        color: white !important;
      }
      .wrong-answer {
        background-color: #7f1d1d !important;
        border-color: #ef4444 !important;
        color: white !important;
        animation: shake 0.4s both;
      }
      .disabled-opts {
        pointer-events: none;
        opacity: 0.6;
      }
      .locked-blur {
        filter: blur(8px);
        user-select: none;
        transition: filter 0.5s ease;
      }
      .unlocked {
        filter: blur(0);
      }
      @keyframes shake {
        10%,
        90% {
          transform: translate3d(-1px, 0, 0);
        }
        20%,
        80% {
          transform: translate3d(2px, 0, 0);
        }
        30%,
        50%,
        70% {
          transform: translate3d(-4px, 0, 0);
        }
        40%,
        60% {
          transform: translate3d(4px, 0, 0);
        }
      }

      .category-pill {
        font-family: "JetBrains Mono", monospace;
        font-size: 0.65rem;
        text-transform: uppercase;
        padding: 4px 8px;
        border-radius: 4px;
        background: #451a03;
        color: #fbbf24;
        border: 1px solid #92400e;
      }
      .stat-box {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 0 16px;
      }
      .stat-value {
        font-family: "JetBrains Mono", monospace;
        font-weight: bold;
        font-size: 1.2rem;
      }
      .stat-label {
        font-size: 0.65rem;
        text-transform: uppercase;
        color: #71717a;
        letter-spacing: 0.1em;
      }
      .nav-active {
        color: #fbbf24 !important;
        border-bottom: 2px solid #fbbf24;
      }
      #api-modal {
        background: rgba(0, 0, 0, 0.8);
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 100;
        display: none;
        justify-content: center;
        align-items: center;
      }
    </style>
  </head>
  <body class="min-h-screen flex flex-col items-center py-6">
    <!-- API Key Modal -->
    <div id="api-modal">
      <div
        class="bg-[#18181b] border border-stone-700 p-8 rounded-2xl max-w-md w-full shadow-2xl"
      >
        <h2 class="text-xl font-bold text-white mb-2" id="modal-title">
          üîë Configure Gemini API
        </h2>
        <p class="text-stone-400 text-sm mb-4" id="modal-desc">
          Enter your Google Gemini API Key to enable AI features. Stored
          locally.
        </p>
        <input
          type="password"
          id="api-key-input"
          placeholder="Paste API Key here..."
          class="w-full bg-black border border-stone-700 rounded-lg p-3 text-white mb-4 focus:border-amber-500 outline-none"
        />
        <div class="flex justify-end gap-3">
          <button
            onclick="closeApiModal()"
            class="text-stone-400 hover:text-white text-sm"
            id="modal-cancel"
          >
            Cancel
          </button>
          <button
            onclick="saveApiKey()"
            class="bg-amber-600 hover:bg-amber-500 text-black font-bold py-2 px-4 rounded-lg transition"
            id="modal-save"
          >
            Save Key
          </button>
        </div>
      </div>
    </div>

    <!-- HEADER -->
    <div
      class="fixed top-0 z-50 w-full bg-[#09090b]/90 backdrop-blur-md border-b border-white/10"
    >
      <div
        class="max-w-6xl mx-auto px-4 py-3 flex flex-col md:flex-row justify-between items-center gap-4"
      >
        <div class="flex items-center gap-8">
          <div class="text-left">
            <h1 class="text-xl font-bold text-white tracking-tight">
              DP-600 <span class="text-amber-500">ATLAS</span>
            </h1>
          </div>
          <div
            class="flex gap-6 text-sm font-bold tracking-widest text-stone-500"
          >
            <button
              onclick="switchView('simulator')"
              id="nav-sim"
              class="hover:text-white transition py-2 nav-active"
            >
              SIMULATOR
            </button>
            <button
              onclick="switchView('coach')"
              id="nav-coach"
              class="hover:text-white transition py-2 flex items-center gap-1"
            >
              AI COACH <span class="text-[10px] text-amber-500">‚ú®</span>
            </button>
            <button
              onclick="switchView('codex')"
              id="nav-codex"
              class="hover:text-white transition py-2"
            >
              CODEX
            </button>
            <button
              onclick="switchView('cheatsheet')"
              id="nav-cheat"
              class="hover:text-white transition py-2"
            >
              CHEAT SHEET
            </button>
          </div>
        </div>

        <div id="sim-filters" class="flex bg-white/5 rounded-lg p-1">
          <button
            onclick="setMode('all')"
            id="btn-all"
            class="px-3 py-1 text-xs font-bold rounded hover:text-white transition text-amber-500 bg-white/10"
          >
            ALL
          </button>
          <button
            onclick="setMode('core')"
            id="btn-core"
            class="px-3 py-1 text-xs font-bold rounded text-stone-400 hover:text-white transition"
          >
            CORE
          </button>
          <button
            onclick="setMode('boss')"
            id="btn-boss"
            class="px-3 py-1 text-xs font-bold rounded text-stone-400 hover:text-white transition"
          >
            BOSS
          </button>
          <button
            onclick="setMode('code')"
            id="btn-code"
            class="px-3 py-1 text-xs font-bold rounded text-cyan-400 hover:text-white transition border border-cyan-900/50 ml-1"
          >
            CODE
          </button>
        </div>

        <div class="flex items-center gap-2">
          <!-- NAVIGATION ARROWS -->
          <button
            onclick="prevQuestion()"
            class="w-8 h-8 flex items-center justify-center rounded-full bg-stone-800 text-stone-400 hover:bg-stone-700 hover:text-white transition border border-stone-700"
            title="Previous Question"
          >
            ‚Üê
          </button>
          <button
            onclick="nextQuestion()"
            class="w-8 h-8 flex items-center justify-center rounded-full bg-stone-800 text-stone-400 hover:bg-stone-700 hover:text-white transition border border-stone-700 mr-2"
            title="Next Question"
          >
            ‚Üí
          </button>

          <div class="stat-box">
            <span id="score-display" class="stat-value text-emerald-400">0</span
            ><span class="stat-label">XP</span>
          </div>
          <div class="h-6 w-px bg-white/10"></div>
          <div class="stat-box">
            <span id="streak-display" class="stat-value text-amber-500">0</span
            ><span class="stat-label">Streak</span>
          </div>

          <div class="h-6 w-px bg-white/10 ml-2"></div>
          <!-- Language Toggle -->
          <button
            onclick="toggleLanguage()"
            class="text-xl hover:scale-110 transition p-2"
            title="Switch Language"
            id="lang-btn"
          >
            üá∏üá™
          </button>

          <button
            onclick="openApiModal()"
            class="text-xs text-stone-500 hover:text-amber-400 transition p-2"
            title="API Settings"
          >
            ‚öôÔ∏è
          </button>
          <button
            onclick="resetProgress()"
            class="text-xs text-stone-500 hover:text-red-400 transition p-2"
            title="Reset Data"
          >
            ‚Ü∫
          </button>
        </div>
      </div>
    </div>

    <!-- VIEW: SIMULATOR -->
    <div
      id="view-simulator"
      class="w-full max-w-[1400px] mt-24 px-4 transition-opacity duration-300"
    >
      <div
        class="flex flex-col xl:flex-row gap-6 items-center justify-center mb-10"
      >
        <!-- Question Card -->
        <div class="relative group">
          <div
            class="absolute -top-3 left-1/2 -translate-x-1/2 bg-amber-600 text-black text-[10px] font-bold px-3 py-1 rounded-full z-10 tracking-widest"
            id="label-mission"
          >
            MISSION
          </div>
          <div id="card-question" class="phone-frame p-6"></div>
          <div
            id="nav-overlay"
            class="absolute bottom-6 left-0 w-full px-6 hidden z-20 flex gap-2"
          >
            <button
              onclick="generateAIQuestion()"
              id="btn-ai-gen"
              class="flex-1 bg-purple-900/80 border border-purple-500 text-white font-bold py-3 rounded-xl hover:bg-purple-800 transition shadow-lg flex justify-center items-center gap-2 text-xs"
            >
              <span>‚ú®</span> NEW SCENARIO
            </button>
            <button
              onclick="nextQuestion()"
              id="btn-next"
              class="flex-[2] bg-white text-black font-bold py-3 rounded-xl hover:bg-amber-400 transition shadow-lg transform hover:scale-105 flex justify-center items-center gap-2"
            >
              NEXT <span>‚Üí</span>
            </button>
          </div>
        </div>

        <!-- Answer Card -->
        <div class="relative group w-full xl:w-auto flex justify-center">
          <div
            class="absolute -top-3 left-1/2 -translate-x-1/2 bg-stone-700 text-stone-300 text-[10px] font-bold px-3 py-1 rounded-full z-10 tracking-widest z-20"
            id="label-intel"
          >
            INTEL
          </div>
          <div id="card-answer" class="phone-frame p-6 relative">
            <div
              id="lock-overlay-a"
              class="absolute inset-0 flex flex-col items-center justify-center z-10 transition-opacity duration-500"
            >
              <div class="text-4xl mb-2">üîí</div>
              <p class="text-xs font-mono text-stone-500 uppercase">
                Classified Intel
              </p>
            </div>
            <div
              id="content-answer"
              class="locked-blur h-full flex flex-col"
            ></div>
          </div>
        </div>

        <!-- Grandma Card -->
        <div class="relative group w-full xl:w-auto flex justify-center">
          <div
            class="absolute -top-3 left-1/2 -translate-x-1/2 bg-stone-700 text-stone-300 text-[10px] font-bold px-3 py-1 rounded-full z-10 tracking-widest z-20"
            id="label-strategy"
          >
            STRATEGY
          </div>
          <div id="card-grandma" class="phone-frame p-6 relative">
            <div
              id="lock-overlay-b"
              class="absolute inset-0 flex flex-col items-center justify-center z-10 transition-opacity duration-500"
            >
              <div class="text-4xl mb-2">üß†</div>
              <p class="text-xs font-mono text-stone-500 uppercase">
                Brain Link
              </p>
            </div>
            <div
              id="content-grandma"
              class="locked-blur h-full flex flex-col items-center text-center justify-center"
            ></div>
          </div>
        </div>
      </div>
    </div>

    <!-- VIEW: AI COACH -->
    <div
      id="view-coach"
      class="w-full max-w-3xl mx-auto mt-24 px-4 hidden mb-20"
    >
      <div class="text-center mb-8">
        <h2
          class="text-4xl font-black text-white mb-2 tracking-tight flex justify-center items-center gap-3"
        >
          <span class="text-amber-500">‚ú®</span> ATLAS COACH
        </h2>
        <p class="text-stone-400" id="coach-subtitle">
          Ask me anything about DP-600. I speak "Grandma".
        </p>
      </div>
      <div class="chat-container">
        <div id="chat-messages" class="chat-messages">
          <div class="msg msg-ai" id="coach-welcome">
            üëã <strong>Atlas h√§r.</strong> Jag √§r din externa hj√§rna. Fr√•ga mig
            om Fabric, DirectLake, eller be mig f√∂rklara T-SQL som om du vore 5
            √•r.
          </div>
        </div>
        <div class="chat-input-area">
          <input
            type="text"
            id="chat-input"
            placeholder="Fr√•ga Atlas..."
            class="flex-grow bg-black border border-stone-700 rounded-lg p-3 text-white focus:border-amber-500 outline-none"
            onkeypress="handleEnter(event)"
          />
          <button
            onclick="sendChatMessage()"
            class="bg-amber-600 hover:bg-amber-500 text-black font-bold p-3 rounded-lg transition"
          >
            ‚û§
          </button>
        </div>
      </div>
    </div>

    <!-- VIEW: THE CODEX -->
    <div
      id="view-codex"
      class="w-full max-w-4xl mx-auto mt-24 px-4 hidden mb-20"
    >
      <div class="text-center mb-12">
        <h2 class="text-4xl font-black text-white mb-2 tracking-tight">
          THE ATLAS CODEX
        </h2>
        <p class="text-stone-400" id="codex-subtitle">
          Mastery through Simplification.
        </p>
      </div>
      <div id="codex-content" class="space-y-8"></div>
    </div>

    <!-- VIEW: CHEAT SHEET -->
    <div
      id="view-cheatsheet"
      class="w-full max-w-5xl mx-auto mt-24 px-4 hidden mb-20"
    >
      <div class="text-center mb-12">
        <h2 class="text-4xl font-black text-white mb-2 tracking-tight">
          ARCHITECT'S CHEAT SHEET
        </h2>
        <p class="text-stone-400" id="cheat-subtitle">
          Your Logical Compass: "If X happens -> Do Y"
        </p>
      </div>
      <div class="grid gap-12" id="cheat-content">
        <!-- Content Injected via JS -->
      </div>
    </div>

    <script>
      // ==========================================
      //  LOCALIZATION ENGINE
      // ==========================================
      const langData = {
        sv: {
          nav_sim: "SIMULATOR",
          nav_coach: "AI COACH",
          nav_codex: "CODEX",
          nav_cheat: "LATHUND",
          btn_all: "ALLA",
          btn_core: "GRUND",
          btn_boss: "BOSS",
          btn_code: "KOD",
          label_mission: "UPPDRAG",
          label_intel: "INTEL",
          label_strategy: "STRATEGI",
          btn_next: "N√ÑSTA",
          btn_ai_gen: "NYTT SCENARIO",
          coach_sub: "St√§ll fr√•gor om DP-600. Jag pratar 'Mormors-spr√•k'.",
          coach_wel:
            "üëã <strong>Atlas h√§r.</strong> Jag √§r din externa hj√§rna. Fr√•ga mig om Fabric, DirectLake, eller be mig f√∂rklara T-SQL som om du vore 5 √•r.",
          coach_ph: "Fr√•ga Atlas...",
          codex_sub: "Bem√§stra genom f√∂renkling.",
          cheat_sub: "Din Logiska Kompass: 'Om X h√§nder -> G√∂r Y'",
          cheat_th_sc: "Scenario",
          cheat_th_sol: "L√∂sning",
          cheat_th_log: "Atlas Logik",
          label_atlas_says: "ATLAS S√ÑGER",
          label_senior: "Senior Arkitekt Tips",
          label_grandma: "Mormors-regeln",
          label_solution: "L√ñSNING",
          label_strategic_rules: "‚ö° Atlas Strategiska Tumregler",
        },
        en: {
          nav_sim: "SIMULATOR",
          nav_coach: "AI COACH",
          nav_codex: "CODEX",
          nav_cheat: "CHEAT SHEET",
          btn_all: "ALL",
          btn_core: "CORE",
          btn_boss: "BOSS",
          btn_code: "CODE",
          label_mission: "MISSION",
          label_intel: "INTEL",
          label_strategy: "STRATEGY",
          btn_next: "NEXT",
          btn_ai_gen: "NEW SCENARIO",
          coach_sub: "Ask me anything about DP-600. I speak 'Grandma'.",
          coach_wel:
            "üëã <strong>Atlas here.</strong> I am your external brain. Ask me about Fabric, DirectLake, or ask me to explain T-SQL like you're 5.",
          coach_ph: "Ask Atlas...",
          codex_sub: "Mastery through Simplification.",
          cheat_sub: "Your Logical Compass: 'If X happens -> Do Y'",
          cheat_th_sc: "Scenario",
          cheat_th_sol: "Solution",
          cheat_th_log: "Atlas Logic",
          label_atlas_says: "ATLAS SAYS",
          label_senior: "Senior Architect Tip",
          label_grandma: "The Grandma Rule",
          label_solution: "SOLUTION",
          label_strategic_rules: "‚ö° Atlas Strategic Rules",
        },
      };

      // ==========================================
      //  DATABASE: FULL QUESTION BANK
      // ==========================================
      const questionBank = [
        // --- CORE 1-5 (Examples) ---
        {
          id: 1,
          type: "core",
          cat: "Fabric Capacity",
          icon: "ü™£",
          q: "Vad √§r 'Bursting'?",
          scenario:
            "CPU-anv√§ndningen sl√•r i taket kl 09:00, men ingen strypning sker. Hur?",
          opts: [
            "Fri prestanda",
            "L√•nar fr√•n framtiden",
            "Cache-minne",
            "Ingen gr√§ns",
          ],
          correct: 1,
          senior:
            "Bursting l√•nar resurser, men det √§r 'Smoothing' som smetar ut fakturan √∂ver 24h f√∂r att undvika omedelbar strypning.",
          grandma:
            "Det √§r som ett kreditkort. Du kan k√∂pa en dyr TV (tung query) nu, men du m√•ste betala av skulden senare.",
        },
        {
          id: 2,
          type: "core",
          cat: "OneLake",
          icon: "üîó",
          q: "Analysera S3-data?",
          scenario:
            "Kunden har 50TB i AWS. Vill anv√§nda Fabric men v√§grar betala f√∂r migrering.",
          opts: ["Copy Activity", "Shortcuts", "Mirroring", "G√•r ej"],
          correct: 1,
          senior:
            "Shortcuts virtualiserar datat. Metadata i OneLake, men bitarna ligger kvar i S3. Zero Copy.",
          grandma:
            "Skapa en genv√§g p√• skrivbordet. Filen ligger kvar i mappen, men du √∂ppnar den h√§rifr√•n.",
        },
        {
          id: 3,
          type: "core",
          cat: "Security",
          icon: "üîë",
          q: "Vem ska vara 'Contributor'?",
          scenario: "En s√§ljare ska BARA kunna l√§sa rapporter, inget annat.",
          opts: ["Contributor", "Member", "Viewer", "Admin"],
          correct: 2,
          senior:
            "Contributor kan redigera/radera. Viewer ger strikt 'Read Only' och aktiverar RLS.",
          grandma:
            "Ge inte husnyckeln (Contributor) till n√•gon som bara ska titta genom f√∂nstret (Viewer).",
        },
        {
          id: 4,
          type: "core",
          cat: "Git Integration",
          icon: "üß¨",
          q: "Vilket filformat?",
          scenario:
            "Du kopplar Workspace till Azure DevOps. Hur sparas rapporterna?",
          opts: [".pbix", ".bim", ".pbip (Project)", ".zip"],
          correct: 2,
          senior:
            "Fabric anv√§nder PBIP som sparar definitioner i text/JSON, vilket m√∂jligg√∂r diff och merge.",
          grandma:
            "Ist√§llet f√∂r en limmad bok (PBIX) f√•r du en p√§rm med l√∂sa blad (JSON) som kan bytas ut ett och ett.",
        },
        {
          id: 5,
          type: "core",
          cat: "Admin Portal",
          icon: "üõë",
          q: "Stoppa anv√§ndare att skapa items?",
          scenario: "Du vill hindra alla fr√•n att skapa nya Workspaces.",
          opts: [
            "Kapacitetsinst√§llning",
            "Tenant Setting",
            "Workspace Setting",
            "AD Group",
          ],
          correct: 1,
          senior:
            "Tenant Settings √§r den globala switchen. Kan begr√§nsas till specifika s√§kerhetsgrupper.",
          grandma:
            "Huvudstr√∂mbrytaren i proppsk√•pet styr hela huset, inte bara ett rum.",
        },
        {
          id: 6,
          type: "core",
          cat: "Deployment Pipelines",
          icon: "üöÄ",
          q: "Synka Dev till Test?",
          scenario:
            "Du har gjort √§ndringar i Dev. Hur f√•r du √∂ver dem till Test s√§krast?",
          opts: [
            "Manuell uppladdning",
            "Deployment Pipeline",
            "Copy Paste",
            "Save As",
          ],
          correct: 1,
          senior:
            "Deployment Pipelines hanterar metadata-flytt och parameter-regler (t.ex. byta connection string).",
          grandma:
            "Som ett l√∂pande band i fabriken. En knapptryckning flyttar bilen fr√•n montering (Dev) till lackering (Test).",
        },
        {
          id: 7,
          type: "core",
          cat: "Fabric Domains",
          icon: "üè∑Ô∏è",
          q: "Varf√∂r anv√§nda Dom√§ner?",
          scenario:
            "En stor organisation har data f√∂r HR, Finans och S√§lj i en enda r√∂ra.",
          opts: [
            "B√§ttre prestanda",
            "Logisk gruppering & Governance",
            "Kr√§vs f√∂r Copilot",
            "Billigare",
          ],
          correct: 1,
          senior:
            "Dom√§ner till√•ter decentraliserat √§garskap. HR kan vara admin f√∂r sina workspaces, Finans f√∂r sina.",
          grandma:
            "Ist√§llet f√∂r en stor l√•da med alla leksaker, har vi en l√•da f√∂r Lego (HR) och en f√∂r Bilar (Finans).",
        },
        {
          id: 8,
          type: "core",
          cat: "Capacity Metrics",
          icon: "üìä",
          q: "Hitta 'Noisy Neighbor'?",
          scenario:
            "Hela kapaciteten √§r l√•ngsam. En specifik rapport drar 90% CPU.",
          opts: [
            "Task Manager",
            "Capacity Metrics App",
            "Power BI Admin",
            "Fr√•ga anv√§ndarna",
          ],
          correct: 1,
          senior:
            "Metrics App visar exakt vilken 'Item' (Rapport/Notebook) som konsumerar CU √∂ver tid.",
          grandma:
            "Vem √§ter upp all t√•rta? Kolla √∂vervakningskameran (Metrics App) f√∂r att hitta den skyldige.",
        },
        {
          id: 9,
          type: "core",
          cat: "Storage Modes",
          icon: "üíæ",
          q: "Dyr lagring?",
          scenario: "Du f√•r slut p√• lagringsutrymme i din F64 kapacitet.",
          opts: [
            "K√∂p mer RAM",
            "Lagring √§r separat fr√•n Compute",
            "Radera rapporter",
            "Uppgradera till F128",
          ],
          correct: 1,
          senior:
            "F-SKU betalar f√∂r Compute (CU). Lagring (OneLake) debiteras separat per GB (som ADLSg2).",
          grandma:
            "Hyran f√∂r l√§genheten (Compute) √§r en sak. Kostnaden f√∂r m√∂blerna du st√§ller in (Lagring) √§r en annan.",
        },
        {
          id: 10,
          type: "core",
          cat: "Workspaces",
          icon: "üè†",
          q: "Ta bort Workspace?",
          scenario: "Du raderar ett Workspace. Vad h√§nder med datat i OneLake?",
          opts: [
            "Raderas direkt",
            "Soft Delete (Retention)",
            "Flyttas till Root",
            "Arkiveras f√∂r evigt",
          ],
          correct: 1,
          senior:
            "Det hamnar i 'Soft Delete'. Kan √•terst√§llas inom en viss tid (ofta 7-30 dagar beroende p√• config).",
          grandma:
            "Det hamnar i papperskorgen f√∂rst. Du kan √•ngra dig innan sopbilen kommer.",
        },

        // --- BOSS SCENARIOS 101-118 ---
        {
          id: 101,
          type: "boss",
          cat: "Spark Skew",
          icon: "‚öñÔ∏è",
          q: "Jobbet h√§nger p√• 99%?",
          scenario:
            "Spark-jobbet k√∂r snabbt i b√∂rjan men sista tasken tar 4 timmar.",
          opts: ["√ñka minnet", "Data Skew", "N√§tverksfel", "Uppdatera Spark"],
          correct: 1,
          senior:
            "Data Skew inneb√§r att en partition √§r mycket st√∂rre √§n andra. Anv√§nd 'Salting' eller Adaptive Query Execution (AQE).",
          grandma:
            "En kassa i aff√§ren har 100 kunder i k√∂ (Skew), de andra har ingen. Det spelar ingen roll hur snabb kass√∂rskan √§r.",
        },
        {
          id: 102,
          type: "boss",
          cat: "DirectLake Limitations",
          icon: "‚õî",
          q: "Vyer i DirectLake?",
          scenario:
            "Du skapar en SQL View i Warehouset som joinar 3 tabeller. Power BI DirectLake √§r l√•ngsamt.",
          opts: [
            "Views st√∂ds ej",
            "Det √§r snabbt",
            "Fallback till DQ",
            "M√•ste vara Materialized",
          ],
          correct: 2,
          senior:
            "DirectLake kan inte l√§sa komplexa SQL-vyer direkt. Den m√•ste g√∂ra Fallback till DirectQuery f√∂r att SQL-motorn ska processa vyn.",
          grandma:
            "Om du skriver instruktionerna p√• ett spr√•k (SQL View) som l√§saren (DirectLake) inte kan, m√•ste de anlita en tolk (DirectQuery).",
        },

        // --- CODE QUESTIONS 201-210 ---
        {
          id: 201,
          type: "code",
          cat: "SQL Security",
          icon: "üîí",
          q: "Dynamisk Maskering?",
          scenario:
            "Du m√•ste d√∂lja allt utom de sista 4 siffrorna i 'PhoneNumber'.<br>M√•lformat: <code>XXX-XXX-1234</code>.",
          opts: [
            "FUNCTION = 'partial(\"XXX-XXX-\", 0, 4)'",
            "FUNCTION = 'partial(0, \"XXX-XXX-\", 4, NULL)'",
            "FUNCTION = 'partial(0, 4, \"XXX-XXX-\")'",
            "FUNCTION = 'partial(0, \"XXX-XXX-\", 4)'",
          ],
          correct: 3,
          senior:
            "T-SQL syntaxen √§r <code>partial(prefix_count, padding_string, suffix_count)</code>. Vi vill visa 0 tecken i b√∂rjan, l√§gga till 'XXX-XXX-', och visa 4 i slutet.",
          grandma:
            "Klipp bort b√∂rjan (0), klistra in en lapp (XXX), och spara svansen (4).",
        },
        {
          id: 202,
          type: "code",
          cat: "T-SQL Ingestion",
          icon: "üì•",
          q: "COPY INTO Syntax?",
          scenario:
            "Vilket kommando importerar Parquet-filer fr√•n OneLake till Warehouse snabbast?",
          opts: [
            "INSERT INTO dbo.Table SELECT * FROM 'https://...'",
            "COPY INTO dbo.Table FROM 'https://...' WITH (FILE_TYPE = 'PARQUET')",
            "BULK INSERT dbo.Table FROM 'https://...'",
            "LOAD DATA INFILE 'https://...'",
          ],
          correct: 1,
          senior:
            "COPY INTO √§r det moderna, h√∂gpresterande kommandot f√∂r Fabric Warehouse. BULK INSERT √§r legacy SQL Server.",
          grandma:
            "Anv√§nd r√§tt verktyg. COPY INTO √§r en dammsugare f√∂r data, INSERT √§r en pincett.",
        },
        {
          id: 203,
          type: "code",
          cat: "PySpark Save",
          icon: "üíæ",
          q: "Spara som Delta?",
          scenario:
            "Du har en DataFrame <code>df</code>. Hur sparar du den som en hanterad tabell i Lakehouse?",
          opts: [
            "df.write.format('delta').save('/Tables/MyTable')",
            "df.write.saveAsTable('MyTable')",
            "df.save.table('MyTable')",
            "INSERT INTO MyTable VALUES (df)",
          ],
          correct: 1,
          senior:
            "<code>saveAsTable('Namn')</code> registrerar tabellen i metastoren och hanterar s√∂kv√§gen automatiskt. <code>save()</code> sparar bara filer.",
          grandma:
            "Att 'spara som tabell' √§r som att s√§tta in boken i bibliotekssystemet. Att bara 'spara' √§r att l√§gga boken p√• en hylla utan att ber√§tta f√∂r n√•gon.",
        },
        {
          id: 204,
          type: "code",
          cat: "JSON Handling",
          icon: "üìú",
          q: "Extrahera JSON?",
          scenario:
            "Du har JSON i kolumnen <code>Attributes</code>: <code>{'color': 'red'}</code>. Hur h√§mtar du 'red' i T-SQL?",
          opts: [
            "SELECT Attributes->'color'",
            "SELECT JSON_VALUE(Attributes, '$.color')",
            "SELECT JSON_QUERY(Attributes, '$.color')",
            "SELECT GET_JSON(Attributes, 'color')",
          ],
          correct: 1,
          senior:
            "<code>JSON_VALUE</code> extraherar ett skal√§rt v√§rde (text/nummer). <code>JSON_QUERY</code> extraherar ett objekt/array (mer JSON).",
          grandma:
            "JSON_VALUE plockar ut godiset ur papperet. JSON_QUERY ger dig hela p√•sen.",
        },
        {
          id: 205,
          type: "code",
          cat: "Semantic Link",
          icon: "üîó",
          q: "L√§sa PBI i Python?",
          scenario:
            "Du vill l√§sa tabellen 'Sales' fr√•n ditt dataset 'MyDataset' med SemPy.",
          opts: [
            "fabric.read_table('MyDataset', 'Sales')",
            "pd.read_pbi('MyDataset', 'Sales')",
            "spark.read.dataset('MyDataset').table('Sales')",
            "sempy.fabric.read_table('MyDataset', 'Sales')",
          ],
          correct: 3,
          senior:
            "Biblioteket heter <code>sempy</code>. Syntaxen √§r <code>sempy.fabric.read_table(dataset, table)</code>. Detta √§r unikt f√∂r Fabric.",
          grandma:
            "Du m√•ste anv√§nda r√§tt nyckel (sempy) f√∂r att √∂ppna d√∂rren mellan Python och Power BI.",
        },
        {
          id: 206,
          type: "code",
          cat: "SQL Security",
          icon: "üìß",
          q: "Maskera E-post?",
          scenario:
            "Du vill maskera kolumnen 'Email' s√• att endast f√∂rsta bokstaven syns (t.ex. aXXX@XXXX.com). Vilken funktion?",
          opts: [
            "MASKED WITH (FUNCTION = 'email()')",
            "MASKED WITH (FUNCTION = 'partial(1, \"XXX@XXXX.com\", 0)')",
            "MASKED WITH (FUNCTION = 'default()')",
            "MASKED WITH (FUNCTION = 'hide_email()')",
          ],
          correct: 0,
          senior:
            "T-SQL har en inbyggd <code>email()</code> funktion f√∂r DDM som automatiskt ger formatet 'aXXX@XXXX.com'. Du beh√∂ver inte bygga den manuellt.",
          grandma:
            "Anv√§nd den f√§rdiga st√§mpeln f√∂r e-post, rita inte √∂ver varje brev f√∂r hand.",
        },
        {
          id: 207,
          type: "code",
          cat: "SQL Security",
          icon: "üé≤",
          q: "Slumpm√§ssig L√∂n?",
          scenario:
            "Du vill visa ett slumpm√§ssigt v√§rde mellan 10000 och 50000 f√∂r kolumnen 'Salary' f√∂r obeh√∂riga.",
          opts: [
            "MASKED WITH (FUNCTION = 'random(10000, 50000)')",
            "MASKED WITH (FUNCTION = 'rand(10000, 50000)')",
            "MASKED WITH (FUNCTION = 'default()')",
            "MASKED WITH (FUNCTION = 'partial(0, 0, 0)')",
          ],
          correct: 0,
          senior:
            "Funktionen <code>random(min, max)</code> ers√§tter det riktiga v√§rdet med ett slumpm√§ssigt tal inom intervallet vid l√§sning.",
          grandma:
            "S√§tt en prislapp med ett hittep√•-pris s√• ingen vet vad det egentligen kostar.",
        },
        {
          id: 208,
          type: "code",
          cat: "SQL Permissions",
          icon: "üëÅÔ∏è",
          q: "Se maskerad data?",
          scenario:
            "Anv√§ndaren 'Lily' beh√∂ver se de riktiga v√§rdena i en maskerad tabell. Vilket kommando?",
          opts: [
            "GRANT SELECT TO Lily",
            "GRANT ADMIN TO Lily",
            "GRANT UNMASK TO Lily",
            "ALTER USER Lily SET MASKING = OFF",
          ],
          correct: 2,
          senior:
            "Beh√∂righeten <code>UNMASK</code> √§r den specifika nyckeln som l√•ter en anv√§ndare se genom maskeringen. <code>SELECT</code> r√§cker inte.",
          grandma:
            "Ge Lily r√∂ntgen-glas√∂gonen (UNMASK) s√• hon kan se genom den suddiga texten.",
        },
        {
          id: 209,
          type: "code",
          cat: "SQL Security",
          icon: "üö´",
          q: "Column Level Security?",
          scenario:
            "Du vill helt hindra anv√§ndare fr√•n att ens se att kolumnen 'SSN' existerar (inte bara maskera den).",
          opts: [
            "Anv√§nd Dynamic Data Masking (default)",
            "GRANT SELECT ON Table(Col1, Col2) TO User",
            "CREATE VIEW utan SSN och ge access till Vyn",
            "B√•de B och C fungerar",
          ],
          correct: 3,
          senior:
            "CLS (Column Level Security) implementeras ofta genom att ge <code>GRANT SELECT</code> p√• specifika kolumner eller genom Vyer. DDM d√∂ljer bara v√§rdet, inte kolumnen.",
          grandma:
            "Maskering suddar ut texten. CLS klipper bort hela kolumnen fr√•n pappret.",
        },
        {
          id: 210,
          type: "code",
          cat: "Row Level Security",
          icon: "üïµÔ∏è",
          q: "RLS Predicate?",
          scenario:
            "Du skapar en s√§kerhetspolicy. Vilken funktion filtrerar rader baserat p√• vem som fr√•gar?",
          opts: [
            "USER_NAME() = Region",
            "SUSER_SNAME()",
            "SESSION_USER",
            "Alla ovan kan anv√§ndas beroende p√• kontext",
          ],
          correct: 3,
          senior:
            "I T-SQL f√∂r Fabric Warehouse anv√§nds ofta systemfunktioner som <code>USER_NAME()</code>, <code>SUSER_SNAME()</code> eller <code>SESSION_USER</code> i predikat-funktionen f√∂r att matcha mot data.",
          grandma:
            "Vakten kollar ID-kortet (System Function) och j√§mf√∂r namnet med g√§stlistan.",
        },
      ];

      // --- DRILL GENERATOR FOR FILLER ---
      const drillTemplates = [
        {
          t: "Power BI Refresh",
          s: "Max refresh tid?",
          sc: "Din dataset-uppdatering i en F64-kapacitet misslyckas konsekvent efter exakt 5 timmar.",
          v: ["2h", "5h", "Unlimited", "48h"],
          c: 1,
          senior:
            "Premium/Fabric-kapacitet har en h√•rd gr√§ns p√• 5 timmar f√∂r dataset refresh (om inte XMLA anv√§nds).",
          meta: "Parkeringstiden g√•r ut.",
        },
        {
          t: "Notebook Git",
          s: "Diffa kod?",
          sc: "Du ser en konflikt i en Notebook i Azure DevOps. Hur ser du vad som √§ndrats visuellt?",
          v: ["Text comparison", "Visuell Diff (nbdime)", "G√•r ej", "Binary"],
          c: 1,
          senior:
            "Fabric Git-integrationen renderar en visuell diff f√∂r Notebooks, s√• du slipper l√§sa r√• JSON.",
          meta: "J√§mf√∂r bilderna, inte ettor och nollor.",
        },
        {
          t: "SQL Merge",
          s: "Upsert m√∂nster?",
          sc: "Du beh√∂ver uppdatera existerande rader OCH s√§tta in nya rader i en enda k√∂rning.",
          v: ["INSERT", "UPDATE", "MERGE", "COPY"],
          c: 2,
          senior:
            "MERGE-kommandot hanterar Insert, Update och Delete i en enda atomisk transaktion.",
          meta: "En tv√•v√§gsdragkedja som st√§nger och √∂ppnar samtidigt.",
        },
        {
          t: "Key Vault",
          s: "Hemligheter?",
          sc: "Du har en API-nyckel i din Notebook-kod. S√§kerhetsteamet √§r arga.",
          v: ["H√•rdkoda", "Azure Key Vault", "Env Var", "Textfil"],
          c: 1,
          senior:
            "Anv√§nd aldrig h√•rdkodade l√∂senord. Anv√§nd `mssparkutils.credentials.getSecret()` kopplat till AKV.",
          meta: "L√•s in nyckeln i ett bankfack ist√§llet f√∂r att l√§gga den under mattan.",
        },
      ];

      for (let i = 11; i <= 200; i++) {
        if (i >= 101 && i <= 102) continue; // Skip existing boss items
        if (i >= 201) continue; // Skip code items
        const tmpl = drillTemplates[i % drillTemplates.length];
        questionBank.push({
          id: i,
          type: i < 100 ? "core" : "boss",
          cat: `Drill: ${tmpl.t}`,
          icon: "üéØ",
          q: `${tmpl.s}`,
          scenario: tmpl.sc,
          opts: tmpl.v,
          correct: tmpl.c,
          senior: tmpl.senior,
          grandma: tmpl.meta,
        });
      }

      // CHEAT SHEET DATA
      const cheatData = [
        {
          domain: "üèóÔ∏è DOMAIN 1: INGESTION (F√• in datat)",
          color: "border-blue-500",
          rows: [
            {
              sc: "Kunden har data i AWS S3 / Google Cloud",
              sol: "OneLake Shortcut",
              log: "Zero Copy. Flytta inte 50TB. Peka p√• det.",
            },
            {
              sc: "Data kommer som filer i en mapp (CSV/Parquet)",
              sol: "Copy Activity (Pipeline)",
              log: "Lastbilen. Pipelines √§r optimerade f√∂r bulk-flytt av filer.",
            },
            {
              sc: "Data kommer i realtid (IoT/Loggar)",
              sol: "Eventstream + KQL",
              log: "Brandslangen. KQL dricker snabbast. Spark hinner inte med.",
            },
            {
              sc: "Kunden har en SQL Server On-Prem (lokalt)",
              sol: "On-Premises Data Gateway",
              log: "Tunneln. Du m√•ste borra genom brandv√§ggen.",
            },
            {
              sc: "Kunden har Cosmos DB eller Azure SQL",
              sol: "Mirroring",
              log: "Spegeln. Replikerar automatiskt utan kod. Datat dyker bara upp.",
            },
            {
              sc: "Komplex API-h√§mtning med loopar/auth",
              sol: "Notebook (Python)",
              log: "Kirurgen. Pipelines √§r klumpiga f√∂r komplex logik. Python l√∂ser allt.",
            },
          ],
        },
        {
          domain: "üç≥ DOMAIN 2: TRANSFORMATION (Laga maten)",
          color: "border-purple-500",
          rows: [
            {
              sc: "Teamet kan SQL men hatar Python",
              sol: "Stored Procedures (Warehouse)",
              log: "Verktygsl√•dan. Tvinga inte fram spr√•kbyte om kompetensen saknas.",
            },
            {
              sc: "Teamet kan inte koda alls (Low-code)",
              sol: "Dataflow Gen2",
              log: "Visuellt. Enkelt underh√•ll, men l√•ngsammare √§n kod.",
            },
            {
              sc: "Extremt komplex logik / Machine Learning",
              sol: "Spark Notebooks",
              log: "Tungt Artilleri. N√§r SQL inte r√§cker till.",
            },
            {
              sc: "Du har miljontals sm√• filer (prestanda d√∂d)",
              sol: "OPTIMIZE & VACUUM",
              log: "St√§dpatrullen. Sl√• ihop sm√• filer och sl√§ng skr√§pet.",
            },
            {
              sc: "Datat √§r 'smutsigt' (fel format, dubbletter)",
              sol: "Land i Bronze -> Tv√§tta till Silver",
              log: "Medallion. Blanda aldrig r√•tt k√∂tt med salladen.",
            },
          ],
        },
        {
          domain: "üíæ DOMAIN 3: STORAGE (Lagra & Servera)",
          color: "border-emerald-500",
          rows: [
            {
              sc: "Power BI rapporten √§r l√•ngsam",
              sol: "DirectLake",
              log: "Direktlinjen. Snabbare √§n DirectQuery, enklare √§n Import.",
            },
            {
              sc: "Tabellen √§r enorm (miljarder rader)",
              sol: "Partitionering",
              log: "Kartoteket. L√§s bara relevanta mappar (t.ex. √Ör/M√•nad).",
            },
            {
              sc: "Du beh√∂ver historik / Undo",
              sol: "Delta Time Travel",
              log: "Tidsmaskinen. Backa bandet till hur datat s√•g ut ig√•r.",
            },
            {
              sc: "Mass-ladda data till Warehouse",
              sol: "T-SQL COPY INTO",
              log: "Hjullastaren. INSERT √§r en tesked. COPY INTO √§r en lastbil.",
            },
            {
              sc: "Du vill testa en destruktiv √§ndring",
              sol: "CLONE TABLE (Zero Copy)",
              log: "Tvillingen. Gratis kopia p√• noll sekunder. Lek med kopian.",
            },
          ],
        },
        {
          domain: "üõ°Ô∏è DOMAIN 4: SECURITY (Vakten)",
          color: "border-amber-500",
          rows: [
            {
              sc: "S√§ljare f√•r bara se sina egna kunder",
              sol: "Row-Level Security (RLS)",
              log: "Skygglappar. Filtrera rader baserat p√• USER_NAME().",
            },
            {
              sc: "Ingen f√•r se personnummer (SSN) alls",
              sol: "Column-Level Security",
              log: "Saxen. Klipp bort hela kolumnen f√∂r obeh√∂riga.",
            },
            {
              sc: "Testare ska se format (XXX-1234) men inte data",
              sol: "Dynamic Data Masking",
              log: "Pixellering. D√∂lj v√§rdet men beh√•ll formatet.",
            },
            {
              sc: "Vem raderade tabellen?",
              sol: "Monitoring Hub / Audit Logs",
              log: "Svarta l√•dan. Hitta den skyldige.",
            },
            {
              sc: "Du vill dela rapporten externt",
              sol: "Entra ID Guest User (B2B)",
              log: "G√§stpasset. Skapa inte ett nytt konto, bjud in g√§sten.",
            },
          ],
        },
      ];

      // STRATEGISKA REGLER (F√∂r slutet av Cheat Sheet sidan)
      const strategicRules = [
        {
          t: "Flytta aldrig data i on√∂dan.",
          d: "Anv√§nd Shortcuts f√∂rst. Kopiera bara om du m√•ste transformera.",
        },
        {
          t: "L√§s aldrig allt om du bara beh√∂ver lite.",
          d: "Anv√§nd Partitionering och Incremental Refresh.",
        },
        {
          t: "Rapporten ska vara dum.",
          d: "Flytta logiken till Warehouse/Dataflow. Rapporten ska bara visa resultatet.",
        },
        {
          t: "H√•rdkoda aldrig.",
          d: "Anv√§nd Parametrar i Pipelines och Key Vault f√∂r l√∂senord.",
        },
      ];

      // CODEX DATA
      const codexData = [
        {
          title: "Domain 1: Plan & Manage (The City Planner)",
          desc: "Architecture, Administration, and Governance.",
          color: "border-blue-500",
          topics: [
            {
              concept: "OneLake",
              boring:
                "A single, unified, logical data lake for the whole organization based on ADLS Gen2.",
              atlas:
                "OneDrive f√∂r Data. En enda gigantisk h√•rddisk som alla dina verktyg (Spark, SQL, PBI) delar p√•. Du slipper kopiera filer mellan olika konton. 'One Copy' to rule them all.",
            },
            {
              concept: "Capacity (F-SKU vs P-SKU)",
              boring:
                "Fabric Capacity is a dedicated set of resources used to run Fabric workloads.",
              atlas:
                "Hyran f√∂r l√§genheten. F-SKU √§r Azure (Pay-as-you-go, du kan pausa). P-SKU √§r Microsoft 365 (M√•nadshyra, kan inte pausas). Om kapaciteten tar slut g√•r proppen (Throttling/Smoothing).",
            },
            {
              concept: "Shortcuts",
              boring:
                "Objects in OneLake that point to other storage locations without moving data.",
              atlas:
                "Genv√§gar p√• skrivbordet. Filen ligger kvar i Amazon S3 eller Google Cloud, men du dubbelklickar p√• den i Fabric som om den l√•g d√§r. Ingen kopiering = Ingen v√§ntetid.",
            },
            {
              concept: "Workspaces & Domains",
              boring:
                "Containers for items that also define security boundaries.",
              atlas:
                "Workspace = Ett projekt-rum d√§r teamet jobbar. Domain = En hel avdelning (HR, Finans). Domains hj√§lper dig att gruppera workspaces s√• att Finans-chefen kan styra sina egna rum utan att ringa IT.",
            },
            {
              concept: "Git Integration (PBIP)",
              boring:
                "Source control integration utilizing the Power BI Project (.pbip) format.",
              atlas:
                "Tidsmaskin f√∂r koden. F√∂rr var PBI-filer bin√§ra klumpar. Nu √§r de textmappar (PBIP) som g√∂r att du kan se exakt VEM som √§ndrade VILKEN rad i koden.",
            },
          ],
        },
        {
          title: "Domain 2: Ingest & Transform (The Factory Floor)",
          desc: "Data Engineering, Pipelines, and Data Science.",
          color: "border-purple-500",
          topics: [
            {
              concept: "Lakehouse vs Warehouse",
              boring:
                "Lakehouse uses Spark/Python primarily. Warehouse uses T-SQL primarily.",
              atlas:
                "Lakehouse = Din 'Messy Desk'. H√§r dumpar du allt (Bilder, CSV, JSON). Du anv√§nder Python (Spark) f√∂r att st√§da. Warehouse = Ditt 'Arkivsk√•p'. H√§r f√•r bara f√§rdiga, rena tabeller ligga. Endast strikt SQL till√•tet.",
            },
            {
              concept: "Dataflow Gen2",
              boring:
                "Low-code data ingestion and transformation tool based on Power Query.",
              atlas:
                "Power Query p√• steroider. Nu kan den skriva data till en databas (Destination), inte bara l√§sa. Perfekt f√∂r 'Medborgar-utvecklare' som inte kan koda Python.",
            },
            {
              concept: "Spark Notebooks",
              boring:
                "Interactive coding environment supporting Python, Scala, R, and Spark SQL.",
              atlas:
                "Kungens verktyg (Python). Om du beh√∂ver g√∂ra tunga lyft, maskininl√§rning eller komplex logik som SQL inte klarar av ‚Äì anv√§nd en Notebook. Det √§r h√§r magin h√§nder.",
            },
            {
              concept: "Medallion Architecture",
              boring:
                "Multi-hop architecture: Bronze (Raw), Silver (Cleaned), Gold (Curated).",
              atlas:
                "Matlagning. Bronze = R√•varorna direkt fr√•n bonden (smutsiga mor√∂tter). Silver = Skalade och hackade gr√∂nsaker. Gold = Den f√§rdiga grytan serverad p√• bordet.",
            },
            {
              concept: "V-Order",
              boring:
                "Write-optimization technology for Parquet files to enhance read performance.",
              atlas:
                "Sortera bokhyllan perfekt. Det tar lite l√§ngre tid att st√§lla in b√∂ckerna (skriva), men det g√•r blixtsnabbt att hitta dem sen (l√§sa).",
            },
          ],
        },
        {
          title: "Domain 3: Model & Serve (The Librarian)",
          desc: "Data Warehousing and Semantic Models.",
          color: "border-emerald-500",
          topics: [
            {
              concept: "DirectLake",
              boring:
                "A semantic model storage mode where Power BI reads directly from Delta Parquet files.",
              atlas:
                "Drick direkt ur kranen. Gamla 'Import Mode' kr√§vde att du fyllde flaskor (laddade RAM) och k√∂rde dem till PBI. DirectLake drar ett r√∂r rakt in i filen. Blixtsnabbt, noll v√§ntetid.",
            },
            {
              concept: "Star Schema",
              boring:
                "Modeling technique with Fact tables and Dimension tables.",
              atlas:
                "Fortfarande kungen. Power BI hatar platta tabeller (Excel-style). Bygg alltid en Stj√§rna: En h√§ndelse i mitten (Fact: S√§ljtransaktion) omringad av 'Vem, Vad, Var, N√§r' (Dimensions).",
            },
            {
              concept: "T-SQL COPY INTO",
              boring: "High-performance command to load data into Warehouse.",
              atlas:
                "Brandslangen. Anv√§nd inte 'INSERT INTO' (Tr√§dg√•rdsslang) om du ska fylla en pool med data. COPY INTO √§r optimerat f√∂r massiv datam√§ngd.",
            },
            {
              concept: "Incremental Refresh",
              boring:
                "Partition-based refresh policy to only load changed data.",
              atlas:
                "Tv√§tta bara smutstv√§tten. Varf√∂r tv√§tta hela garderoben (ladda om 10 √•r data) n√§r du bara anv√§nde en tr√∂ja ig√•r?",
            },
          ],
        },
        {
          title: "Domain 4: Analyze (The Art Gallery)",
          desc: "Power BI and Real-Time Intelligence.",
          color: "border-amber-500",
          topics: [
            {
              concept: "Semantic Link (SemPy)",
              boring:
                "A Python library bridging the gap between Data Science and Power BI.",
              atlas:
                "Bryggan. L√•ter dig l√§sa dina Power BI-m√•tt direkt in i en Python Notebook. Sluta r√§kna om 'Gross Margin' i Python, h√§mta den fr√•n modellen ist√§llet!",
            },
            {
              concept: "KQL (Kusto)",
              boring:
                "Query language optimized for large volumes of real-time/log data.",
              atlas:
                "S√∂kmotorn. SQL √§r d√•ligt p√• miljarder rader text-loggar. KQL √§r byggt f√∂r att hitta n√•len i h√∂stacken p√• millisekunder. T√§nk 'Ctrl+F' f√∂r Big Data.",
            },
            {
              concept: "Data Activator (Reflex)",
              boring: "No-code system to drive actions from data patterns.",
              atlas:
                "Larmklockan. Den tittar p√• din data dygnet runt. Om 'Temperatur > 50', skicka ett Teams-meddelande direkt.",
            },
          ],
        },
      ];

      // ==========================================
      //  STATE & FUNCTIONS
      // ==========================================
      let state = {
        view: "simulator",
        score: 0,
        streak: 0,
        mode: "all",
        activeDeck: [],
        currentIndex: 0,
        attemptsLeft: 3,
        isLocked: false,
        apiKey: "",
        language: "sv",
      };

      const saved = localStorage.getItem("dp600_atlas_ultimate");
      if (saved) {
        const p = JSON.parse(saved);
        state.score = p.score || 0;
        state.streak = p.streak || 0;
        state.apiKey = p.apiKey || "";
        state.language = p.language || "sv";
      }

      function init() {
        setMode("all");
        applyLanguage();
        renderCodex();
        renderCheatSheet();
        updateStatsUI();
      }

      // Render Cheat Sheet
      function renderCheatSheet() {
        const container = document.getElementById("cheat-content");
        const t = langData[state.language];
        let html = "";

        // Render Tables
        cheatData.forEach((d) => {
          let rows = "";
          d.rows.forEach((r) => {
            rows += `<tr><td class="cheat-scenario">${r.sc}</td><td class="cheat-solution">${r.sol}</td><td class="cheat-logic">${r.log}</td></tr>`;
          });
          html += `<div class="codex-card border-l-4 ${d.color}"><h3 class="text-2xl font-bold text-white mb-6">${d.domain}</h3><div class="overflow-x-auto"><table class="w-full text-left cheat-table"><thead class="bg-white/5 text-stone-100 uppercase"><tr><th>${t.cheat_th_sc}</th><th>${t.cheat_th_sol}</th><th>${t.cheat_th_log}</th></tr></thead><tbody class="divide-y divide-white/5">${rows}</tbody></table></div></div>`;
        });

        // Render Strategic Rules
        html += `<div class="bg-gradient-to-r from-stone-900 to-black p-8 rounded-2xl border border-stone-800 text-center"><h3 class="text-xl font-bold text-white mb-6 uppercase tracking-widest">${t.label_strategic_rules}</h3><div class="grid md:grid-cols-2 gap-6 text-left"><div class="p-4 bg-white/5 rounded-lg border border-white/10"><span class="text-amber-500 font-bold block mb-1">1. Flytta aldrig data i on√∂dan.</span><span class="text-stone-400 text-sm">Anv√§nd Shortcuts f√∂rst.</span></div><div class="p-4 bg-white/5 rounded-lg border border-white/10"><span class="text-amber-500 font-bold block mb-1">2. L√§s aldrig allt.</span><span class="text-stone-400 text-sm">Anv√§nd Partitionering.</span></div></div></div>`;

        container.innerHTML = html;
      }

      // Render Codex
      function renderCodex() {
        const container = document.getElementById("codex-content");
        const t = langData[state.language];
        let html = "";
        codexData.forEach((domain) => {
          let topicsHtml = "";
          domain.topics.forEach((tp) => {
            topicsHtml += `<div class="mb-8 last:mb-0"><div class="topic-header"><span class="text-amber-500 text-xl">‚óè</span><h4 class="text-white font-bold text-lg">${tp.concept}</h4></div><div class="boring-def">"${tp.boring}"</div><div class="atlas-trans"><div class="atlas-label">${t.label_atlas_says}</div>${tp.atlas}</div></div>`;
          });
          html += `<div class="codex-card ${domain.color}"><h3 class="text-2xl font-black text-white mb-2">${domain.title}</h3><p class="text-stone-400 text-sm mb-8 border-b border-stone-800 pb-4">${domain.desc}</p><div>${topicsHtml}</div></div>`;
        });
        container.innerHTML = html;
      }

      // ... [Rest of Logic from v4: switchView, setMode, loadQuestion, handleAnswer, API calls] ...

      function switchView(viewName) {
        state.view = viewName;
        const views = ["simulator", "codex", "cheatsheet", "coach"];
        views.forEach((v) => {
          document.getElementById(`view-${v}`).classList.add("hidden");
          document.getElementById(
            `nav-${v === "cheatsheet" ? "cheat" : v === "simulator" ? "sim" : v}`,
          ).className =
            v === "coach"
              ? "hover:text-white transition py-2 flex items-center gap-1"
              : "hover:text-white transition py-2";
        });
        document.getElementById(`view-${viewName}`).classList.remove("hidden");
        const navId =
          viewName === "cheatsheet"
            ? "nav-cheat"
            : viewName === "simulator"
              ? "nav-sim"
              : `nav-${viewName}`;
        document.getElementById(navId).classList.add("nav-active");
        const filters = document.getElementById("sim-filters");
        if (viewName === "simulator") filters.classList.remove("opacity-0");
        else filters.classList.add("opacity-0");
      }

      function setMode(mode) {
        state.mode = mode;
        document
          .querySelectorAll('button[id^="btn-"]')
          .forEach(
            (b) =>
              (b.className =
                "px-3 py-1 text-xs font-bold rounded text-stone-400 hover:text-white transition"),
          );
        if (mode === "code")
          document.getElementById(`btn-${mode}`).className =
            "px-3 py-1 text-xs font-bold rounded text-cyan-400 bg-cyan-900/30 border border-cyan-500 transition shadow-inner ml-1";
        else
          document.getElementById(`btn-${mode}`).className =
            "px-3 py-1 text-xs font-bold rounded text-amber-500 bg-white/10 transition shadow-inner";

        if (mode === "all") state.activeDeck = [...questionBank];
        else state.activeDeck = questionBank.filter((q) => q.type === mode);

        state.activeDeck.sort(() => Math.random() - 0.5);
        state.currentIndex = 0;
        loadQuestion();
      }

      function loadQuestion() {
        const data = state.activeDeck[state.currentIndex];
        const t = langData[state.language];
        state.attemptsLeft = 3;
        state.isLocked = false;
        document.getElementById("nav-overlay").classList.add("hidden");
        ["lock-overlay-a", "lock-overlay-b"].forEach(
          (id) => (document.getElementById(id).style.opacity = "1"),
        );
        ["content-answer", "content-grandma"].forEach((id) => {
          const el = document.getElementById(id);
          el.classList.remove("unlocked");
          el.classList.add("locked-blur");
        });

        let optsHtml = "";
        data.opts.forEach((o, i) => {
          const letter = ["A", "B", "C", "D"][i];
          optsHtml += `<button id="opt-${i}" onclick="handleAnswer(${i})" class="option-btn group"><div class="option-circle group-hover:bg-stone-600 transition">${letter}</div><span class="font-medium">${o}</span></button>`;
        });

        document.getElementById("card-question").innerHTML =
          `<div class="h-full flex flex-col"><div class="flex justify-between items-start mb-4"><span class="category-pill">${data.cat}</span><div class="flex gap-1">${[1, 2, 3].map((n) => `<div id="life-${n}" class="w-2 h-2 rounded-full bg-emerald-500"></div>`).join("")}</div></div><h2 class="text-xl font-bold text-white mb-3 leading-snug">${data.q}</h2><div class="bg-stone-800/50 border-l-2 border-amber-600 p-3 rounded-r-lg mb-6"><p class="text-sm text-stone-400 italic font-mono leading-relaxed">${data.scenario}</p></div><div class="flex-grow space-y-2" id="options-container">${optsHtml}</div><div class="mt-auto pt-4 flex justify-between text-[10px] text-stone-600 font-mono uppercase"><span>ID: #${data.id}</span><span>Attempts: <span id="attempts-display">3</span></span></div></div>`;

        let ansHtml = "";
        data.opts.forEach((o, i) => {
          if (i === data.correct)
            ansHtml += `<div class="p-3 bg-emerald-900/30 border border-emerald-500/50 rounded-lg flex items-center gap-3 mb-2"><div class="text-emerald-500 font-bold">‚úì</div><div class="text-sm font-bold text-white font-mono">${o}</div></div>`;
        });

        document.getElementById("content-answer").innerHTML =
          `<div class="mb-4"><span class="category-pill bg-emerald-900 text-emerald-400 border-emerald-700">${t.label_solution}</span></div><div class="mb-6">${ansHtml}</div><div class="bg-black border border-amber-900/50 p-4 rounded-xl shadow-lg mt-auto relative overflow-hidden"><div class="absolute -right-2 -top-2 text-6xl opacity-10">üí°</div><p class="text-[10px] text-amber-500 font-bold uppercase tracking-widest mb-2">${t.label_senior}</p><p class="text-sm text-stone-300 font-medium leading-relaxed">${data.senior}</p></div>`;
        document.getElementById("content-grandma").innerHTML =
          `<div class="text-6xl mb-6 animate-bounce">üß†</div><h3 class="text-amber-500 font-serif italic text-lg mb-6">"${t.label_grandma}"</h3><p class="text-white text-lg font-medium leading-relaxed px-2">"${data.grandma}"</p>`;
      }

      function handleAnswer(idx) {
        if (state.isLocked) return;
        const data = state.activeDeck[state.currentIndex];
        const btn = document.getElementById(`opt-${idx}`);
        if (idx === data.correct) successSequence(btn);
        else failSequence(btn);
      }

      function successSequence(btn) {
        state.isLocked = true;
        state.score += state.attemptsLeft * 10;
        state.streak++;
        saveData();
        updateStatsUI();
        btn.classList.add("correct-answer");
        confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
        document
          .getElementById("options-container")
          .classList.add("disabled-opts");
        revealIntel();
        document.getElementById("nav-overlay").classList.remove("hidden");
        setTimeout(
          () =>
            document
              .getElementById("card-answer")
              .scrollIntoView({ behavior: "smooth", block: "center" }),
          500,
        );
      }

      function failSequence(btn) {
        state.attemptsLeft--;
        state.streak = 0;
        updateStatsUI();
        btn.classList.add("wrong-answer");
        setTimeout(() => btn.classList.remove("wrong-answer"), 500);
        btn.classList.add("opacity-50", "pointer-events-none");
        document.getElementById(`life-${state.attemptsLeft + 1}`).className =
          "w-2 h-2 rounded-full bg-stone-700";
        document.getElementById("attempts-display").innerText =
          state.attemptsLeft;
        if (state.attemptsLeft <= 0) {
          state.isLocked = true;
          document
            .getElementById(
              `opt-${state.activeDeck[state.currentIndex].correct}`,
            )
            .classList.add("correct-answer", "ring-2", "ring-white");
          revealIntel();
          document.getElementById("nav-overlay").classList.remove("hidden");
          setTimeout(
            () =>
              document
                .getElementById("card-answer")
                .scrollIntoView({ behavior: "smooth", block: "center" }),
            500,
          );
        }
      }

      function revealIntel() {
        ["lock-overlay-a", "lock-overlay-b"].forEach(
          (id) => (document.getElementById(id).style.opacity = "0"),
        );
        ["content-answer", "content-grandma"].forEach((id) => {
          const el = document.getElementById(id);
          el.classList.remove("locked-blur");
          el.classList.add("unlocked");
        });
      }

      // Navigation
      function nextQuestion() {
        if (state.currentIndex < state.activeDeck.length - 1) {
          state.currentIndex++;
          loadQuestion();
          window.scrollTo({ top: 0, behavior: "smooth" });
        } else {
          alert("Mission Complete! Shuffling deck.");
          setMode(state.mode);
        }
      }

      function prevQuestion() {
        if (state.currentIndex > 0) {
          state.currentIndex--;
          loadQuestion();
          window.scrollTo({ top: 0, behavior: "smooth" });
        }
      }

      function updateStatsUI() {
        document.getElementById("score-display").innerText = state.score;
        document.getElementById("streak-display").innerText = state.streak;
      }

      function saveData() {
        localStorage.setItem(
          "dp600_atlas_ultimate",
          JSON.stringify({
            score: state.score,
            streak: state.streak,
            apiKey: state.apiKey,
            language: state.language,
          }),
        );
      }
      function resetProgress() {
        if (confirm("Reset Stats?")) {
          state.score = 0;
          state.streak = 0;
          saveData();
          updateStatsUI();
          init();
        }
      }

      function applyLanguage() {
        const t = langData[state.language];
        const btn = document.getElementById("lang-btn");
        btn.innerHTML = state.language === "sv" ? "üá∏üá™" : "üá∫üá∏";
        document.getElementById("nav-sim").innerText = t.nav_sim;
        document.getElementById("nav-coach").innerHTML =
          `${t.nav_coach} <span class="text-[10px] text-amber-500">‚ú®</span>`;
        document.getElementById("nav-codex").innerText = t.nav_codex;
        document.getElementById("nav-cheat").innerText = t.nav_cheat;
        document.getElementById("btn-all").innerText = t.btn_all;
        document.getElementById("btn-core").innerText = t.btn_core;
        document.getElementById("btn-boss").innerText = t.btn_boss;
        document.getElementById("btn-code").innerText = t.btn_code;
        document.getElementById("label-mission").innerText = t.label_mission;
        document.getElementById("label-intel").innerText = t.label_intel;
        document.getElementById("label-strategy").innerText = t.label_strategy;
        document.getElementById("btn-next").innerHTML =
          `${t.btn_next} <span>‚Üí</span>`;
        document.getElementById("btn-ai-gen").innerHTML =
          `<span>‚ú®</span> ${t.btn_ai_gen}`;
        document.getElementById("coach-subtitle").innerText = t.coach_sub;
        document.getElementById("coach-welcome").innerHTML = t.coach_wel;
        document.getElementById("chat-input").placeholder = t.coach_ph;
        document.getElementById("codex-subtitle").innerText = t.codex_sub;
        document.getElementById("cheat-subtitle").innerText = t.cheat_sub;
        if (state.activeDeck.length > 0) loadQuestion();
        renderCodex();
        renderCheatSheet();
      }

      function toggleLanguage() {
        state.language = state.language === "sv" ? "en" : "sv";
        saveData();
        applyLanguage();
      }

      // API Functions
      function openApiModal() {
        document.getElementById("api-modal").style.display = "flex";
      }
      function closeApiModal() {
        document.getElementById("api-modal").style.display = "none";
      }
      function saveApiKey() {
        const key = document.getElementById("api-key-input").value.trim();
        if (key) {
          state.apiKey = key;
          saveData();
          closeApiModal();
          alert("API Key Saved!");
        }
      }
      async function callGemini(prompt) {
        if (!state.apiKey) {
          openApiModal();
          return null;
        }
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${state.apiKey}`;
        try {
          const response = await fetch(url, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] }),
          });
          const data = await response.json();
          return data.candidates[0].content.parts[0].text;
        } catch (error) {
          console.error("Gemini Error:", error);
          alert("Error calling Gemini API.");
          return null;
        }
      }
      async function sendChatMessage() {
        const input = document.getElementById("chat-input");
        const msg = input.value.trim();
        if (!msg) return;
        const container = document.getElementById("chat-messages");
        container.innerHTML += `<div class="msg msg-user">${msg}</div>`;
        input.value = "";
        container.scrollTop = container.scrollHeight;
        const typingId = "typing-" + Date.now();
        container.innerHTML += `<div id="${typingId}" class="msg msg-ai"><span class="typing-dot"></span><span class="typing-dot"></span><span class="typing-dot"></span></div>`;
        container.scrollTop = container.scrollHeight;
        const langInstr =
          state.language === "sv"
            ? "Respond in Swedish."
            : "Respond in English.";
        const systemPrompt = `You are Atlas, a senior data architect for DP-600. Use 'Grandma rules' (analogies) and 'Senior Tips'. Keep answers concise. ${langInstr}`;
        const fullPrompt = `${systemPrompt}\n\nUser: ${msg}\nAtlas:`;
        const reply = await callGemini(fullPrompt);
        document.getElementById(typingId).remove();
        if (reply)
          container.innerHTML += `<div class="msg msg-ai">${marked.parse(reply)}</div>`;
        else
          container.innerHTML += `<div class="msg msg-ai text-red-400">Connection failed.</div>`;
        container.scrollTop = container.scrollHeight;
      }
      function handleEnter(e) {
        if (e.key === "Enter") sendChatMessage();
      }
      async function generateAIQuestion() {
        const btn = document.getElementById("btn-ai-gen");
        const originalText = btn.innerHTML;
        btn.innerHTML = `<span>‚è≥</span> ...`;
        btn.disabled = true;
        const langInstr =
          state.language === "sv"
            ? "in Swedish (but keep technical terms in English)"
            : "in English";
        const prompt = `Generate a unique multiple-choice question for DP-600 exam. Format as JSON: { "q": "Question text", "scenario": "Scenario text", "opts": ["Option A", "Option B", "Option C", "Option D"], "correct": 0-3 (index), "senior": "Technical explanation ${langInstr}", "grandma": "Simple analogy ${langInstr}" }. Topic: Advanced Fabric Analytics. Response MUST be valid JSON only.`;
        const jsonStr = await callGemini(prompt);
        if (jsonStr) {
          try {
            const cleanJson = jsonStr.replace(/```json|```/g, "").trim();
            const qData = JSON.parse(cleanJson);
            qData.id = 999;
            qData.cat = "AI Generated ‚ú®";
            qData.type = "boss";
            qData.icon = "ü§ñ";
            state.activeDeck.splice(state.currentIndex + 1, 0, qData);
            nextQuestion();
          } catch (e) {
            console.error(e);
            alert("AI Error. Try again.");
          }
        }
        btn.innerHTML = originalText;
        btn.disabled = false;
      }

      init();
    </script>
  </body>
</html>
