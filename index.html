<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DP-600: The Atlas Protocol Ultimate</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #09090b; color: #e4e4e7; overflow-x: hidden; }
        .glass-panel { background: rgba(24, 24, 27, 0.85); backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.08); box-shadow: 0 4px 30px rgba(0, 0, 0, 0.2); }
        .phone-frame { width: 360px; height: 650px; background-color: #18181b; border-radius: 30px; position: relative; overflow: hidden; display: flex; flex-direction: column; border: 1px solid #27272a; transition: all 0.3s ease; }
        .phone-frame:hover { border-color: #d97706; transform: translateY(-2px); box-shadow: 0 10px 40px -10px rgba(217, 119, 6, 0.2); }
        code { font-family: 'JetBrains Mono', monospace; background: #000; padding: 2px 4px; border-radius: 4px; color: #fcd34d; font-size: 0.8em; word-break: break-word; }
        pre { background: #0c0a09; padding: 12px; border-radius: 8px; border: 1px solid #292524; overflow-x: auto; font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; color: #a8a29e; margin-bottom: 12px; white-space: pre-wrap; word-break: break-all; max-width: 100%; }
        .cheat-table th { font-size: 0.75rem; letter-spacing: 0.05em; color: #a1a1aa; font-weight: 700; padding: 12px; border-bottom: 1px solid #27272a; }
        .cheat-table td { padding: 12px; border-bottom: 1px solid #27272a; font-size: 0.9rem; vertical-align: top; }
        .cheat-table tr:last-child td { border-bottom: none; }
        .cheat-scenario { font-weight: 500; color: #e4e4e7; }
        .cheat-solution { color: #fcd34d; font-family: 'JetBrains Mono', monospace; font-weight: 700; }
        .cheat-logic { color: #d6d3d1; font-style: italic; font-size: 0.85rem; }
        .codex-card { background-color: #18181b; border: 1px solid #27272a; border-radius: 16px; padding: 32px; margin-bottom: 32px; transition: all 0.2s ease; }
        .codex-card:hover { border-color: #fbbf24; box-shadow: 0 0 20px rgba(251, 191, 36, 0.05); }
        .topic-header { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid #27272a; }
        .boring-def { border-left: 2px solid #52525b; padding-left: 16px; color: #a1a1aa; font-size: 0.95rem; margin-bottom: 16px; font-style: italic; line-height: 1.6; }
        .atlas-trans { background: linear-gradient(to right, #2a1b0e, #18181b); border-left: 4px solid #d97706; padding: 20px; border-radius: 0 12px 12px 0; color: #fbbf24; font-weight: 500; line-height: 1.6; position: relative; }
        .atlas-label { position: absolute; top: -10px; left: 16px; background: #d97706; color: black; font-size: 0.65rem; font-weight: 900; padding: 2px 8px; border-radius: 4px; text-transform: uppercase; letter-spacing: 0.1em; }
        .chat-container { height: 600px; display: flex; flex-direction: column; background: #18181b; border-radius: 16px; border: 1px solid #27272a; overflow: hidden; }
        .chat-messages { flex-grow: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 16px; }
        .chat-input-area { padding: 16px; background: #27272a; display: flex; gap: 10px; border-top: 1px solid #3f3f46; }
        .msg { padding: 12px 16px; border-radius: 12px; max-width: 80%; font-size: 0.9rem; line-height: 1.5; word-wrap: break-word; }
        .msg-user { align-self: flex-end; background: #2a1b0e; border: 1px solid #d97706; color: white; }
        .msg-ai { align-self: flex-start; background: #27272a; border: 1px solid #3f3f46; color: #d4d4d8; }
        .typing-dot { display: inline-block; width: 6px; height: 6px; background: #d4d4d8; border-radius: 50%; margin: 0 2px; animation: bounce 1.4s infinite ease-in-out both; }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; } .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        .option-btn { width: 100%; text-align: left; background-color: #27272a; border: 1px solid #3f3f46; padding: 12px; margin-bottom: 8px; border-radius: 10px; font-size: 0.85rem; color: #d4d4d8; transition: all 0.1s; display: flex; align-items: flex-start; cursor: pointer; font-family: 'JetBrains Mono', monospace; }
        .option-btn span { flex: 1; min-width: 0; word-wrap: break-word; word-break: break-word; white-space: normal; }
        .option-btn:hover { background-color: #3f3f46; transform: scale(1.02); }
        .option-btn:active { transform: scale(0.98); }
        .option-circle { width: 20px; height: 20px; background-color: #52525b; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.7rem; margin-right: 12px; flex-shrink: 0; font-family: 'Inter', sans-serif; margin-top: 2px; }
        .correct-answer { background-color: #065f46 !important; border-color: #10b981 !important; color: white !important; }
        .wrong-answer { background-color: #7f1d1d !important; border-color: #ef4444 !important; color: white !important; animation: shake 0.4s both; }
        .disabled-opts { pointer-events: none; opacity: 0.6; }
        .locked-blur { filter: blur(8px); user-select: none; transition: filter 0.5s ease; }
        .unlocked { filter: blur(0); }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }
        .category-pill { font-family: 'JetBrains Mono', monospace; font-size: 0.65rem; text-transform: uppercase; padding: 4px 8px; border-radius: 4px; background: #451a03; color: #fbbf24; border: 1px solid #92400e; }
        .stat-box { display: flex; flex-direction: column; align-items: center; padding: 0 16px; }
        .stat-value { font-family: 'JetBrains Mono', monospace; font-weight: bold; font-size: 1.2rem; }
        .stat-label { font-size: 0.65rem; text-transform: uppercase; color: #71717a; letter-spacing: 0.1em; }
        .nav-active { color: #fbbf24 !important; border-bottom: 2px solid #fbbf24; }
        #api-modal { background: rgba(0,0,0,0.8); position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 100; display: none; justify-content: center; align-items: center; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center py-6">

    <div id="api-modal">
        <div class="bg-[#18181b] border border-stone-700 p-8 rounded-2xl max-w-md w-full shadow-2xl">
            <h2 class="text-xl font-bold text-white mb-2" id="modal-title">üîë Configure Gemini API</h2>
            <p class="text-stone-400 text-sm mb-4" id="modal-desc">Enter your Google Gemini API Key to enable AI features. Stored locally.</p>
            <input type="password" id="api-key-input" placeholder="Paste API Key here..." class="w-full bg-black border border-stone-700 rounded-lg p-3 text-white mb-4 focus:border-amber-500 outline-none">
            <div class="flex justify-end gap-3">
                <button onclick="closeApiModal()" class="text-stone-400 hover:text-white text-sm" id="modal-cancel">Cancel</button>
                <button onclick="saveApiKey()" class="bg-amber-600 hover:bg-amber-500 text-black font-bold py-2 px-4 rounded-lg transition" id="modal-save">Save Key</button>
            </div>
        </div>
    </div>

    <div class="fixed top-0 z-50 w-full bg-[#09090b]/90 backdrop-blur-md border-b border-white/10">
        <div class="max-w-6xl mx-auto px-4 py-3 flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="flex items-center gap-8">
                <div class="text-left">
                    <h1 class="text-xl font-bold text-white tracking-tight">DP-600 <span class="text-amber-500">ATLAS</span></h1>
                </div>
                <div class="flex gap-6 text-sm font-bold tracking-widest text-stone-500">
                    <button onclick="switchView('simulator')" id="nav-sim" class="hover:text-white transition py-2 nav-active">SIMULATOR</button>
                    <button onclick="startExamMode()" id="nav-exam" class="hover:text-white transition py-2 text-red-400">EXAM MODE ‚è±Ô∏è</button>
                    <button onclick="switchView('coach')" id="nav-coach" class="hover:text-white transition py-2 flex items-center gap-1">AI COACH <span class="text-[10px] text-amber-500">‚ú®</span></button>
                    <button onclick="switchView('codex')" id="nav-codex" class="hover:text-white transition py-2">CODEX</button>
                    <button onclick="switchView('cheatsheet')" id="nav-cheat" class="hover:text-white transition py-2">CHEAT SHEET</button>
                </div>
            </div>
            
            <div id="sim-filters" class="flex bg-white/5 rounded-lg p-1">
                <button onclick="setMode('all')" id="btn-all" class="px-3 py-1 text-xs font-bold rounded hover:text-white transition text-amber-500 bg-white/10">ALL</button>
                <button onclick="setMode('core')" id="btn-core" class="px-3 py-1 text-xs font-bold rounded text-stone-400 hover:text-white transition">CORE</button>
                <button onclick="setMode('boss')" id="btn-boss" class="px-3 py-1 text-xs font-bold rounded text-stone-400 hover:text-white transition">BOSS</button>
                <button onclick="setMode('code')" id="btn-code" class="px-3 py-1 text-xs font-bold rounded text-cyan-400 hover:text-white transition border border-cyan-900/50 ml-1">CODE</button>
            </div>

            <div class="flex items-center gap-2">
                <button onclick="prevQuestion()" class="w-8 h-8 flex items-center justify-center rounded-full bg-stone-800 text-stone-400 hover:bg-stone-700 hover:text-white transition border border-stone-700" title="Previous">‚Üê</button>
                <button onclick="nextQuestion()" class="w-8 h-8 flex items-center justify-center rounded-full bg-stone-800 text-stone-400 hover:bg-stone-700 hover:text-white transition border border-stone-700 mr-2" title="Next">‚Üí</button>
                
                <div class="stat-box"><span id="score-display" class="stat-value text-emerald-400">0</span><span class="stat-label">XP</span></div>
                <div class="stat-box"><span id="streak-display" class="stat-value text-amber-500">0</span><span class="stat-label">Streak</span></div>
                
                <div class="h-6 w-px bg-white/10 ml-2"></div>
                <button onclick="toggleLanguage()" class="text-xl hover:scale-110 transition p-2" title="Switch Language" id="lang-btn">üá∏üá™</button>
                <button onclick="openApiModal()" class="text-xs text-stone-500 hover:text-amber-400 transition p-2" title="API Settings">‚öôÔ∏è</button>
                <button onclick="resetProgress()" class="text-xs text-stone-500 hover:text-red-400 transition p-2" title="Reset Data">‚Ü∫</button>
            </div>
        </div>
    </div>

    <div id="view-simulator" class="w-full max-w-[1400px] mt-24 px-4 transition-opacity duration-300">
        <div class="flex flex-col xl:flex-row gap-6 items-center justify-center mb-10">
            <div class="relative group">
                <div class="absolute -top-3 left-1/2 -translate-x-1/2 bg-amber-600 text-black text-[10px] font-bold px-3 py-1 rounded-full z-10 tracking-widest" id="label-mission">MISSION</div>
                <div id="card-question" class="phone-frame p-6"></div>
                <div id="nav-overlay" class="absolute bottom-6 left-0 w-full px-6 hidden z-20 flex gap-2">
                    <button onclick="generateAIQuestion()" id="btn-ai-gen" class="flex-1 bg-purple-900/80 border border-purple-500 text-white font-bold py-3 rounded-xl hover:bg-purple-800 transition shadow-lg flex justify-center items-center gap-2 text-xs"><span>‚ú®</span> NEW SCENARIO</button>
                    <button onclick="nextQuestion()" id="btn-next" class="flex-[2] bg-white text-black font-bold py-3 rounded-xl hover:bg-amber-400 transition shadow-lg transform hover:scale-105 flex justify-center items-center gap-2">NEXT <span>‚Üí</span></button>
                </div>
            </div>
            <div class="relative group w-full xl:w-auto flex justify-center">
                <div class="absolute -top-3 left-1/2 -translate-x-1/2 bg-stone-700 text-stone-300 text-[10px] font-bold px-3 py-1 rounded-full z-10 tracking-widest z-20" id="label-intel">INTEL</div>
                <div id="card-answer" class="phone-frame p-6 relative">
                    <div id="lock-overlay-a" class="absolute inset-0 flex flex-col items-center justify-center z-10 transition-opacity duration-500"><div class="text-4xl mb-2">üîí</div><p class="text-xs font-mono text-stone-500 uppercase">Classified Intel</p></div>
                    <div id="content-answer" class="locked-blur h-full flex flex-col"></div>
                </div>
            </div>
            <div class="relative group w-full xl:w-auto flex justify-center">
                <div class="absolute -top-3 left-1/2 -translate-x-1/2 bg-stone-700 text-stone-300 text-[10px] font-bold px-3 py-1 rounded-full z-10 tracking-widest z-20" id="label-strategy">STRATEGY</div>
                <div id="card-grandma" class="phone-frame p-6 relative">
                    <div id="lock-overlay-b" class="absolute inset-0 flex flex-col items-center justify-center z-10 transition-opacity duration-500"><div class="text-4xl mb-2">üß†</div><p class="text-xs font-mono text-stone-500 uppercase">Brain Link</p></div>
                    <div id="content-grandma" class="locked-blur h-full flex flex-col items-center text-center justify-center"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="view-coach" class="w-full max-w-3xl mx-auto mt-24 px-4 hidden mb-20">
        <div class="text-center mb-8"><h2 class="text-4xl font-black text-white mb-2 tracking-tight flex justify-center items-center gap-3"><span class="text-amber-500">‚ú®</span> ATLAS COACH</h2><p class="text-stone-400" id="coach-subtitle">Ask me anything about DP-600.</p></div>
        <div class="chat-container">
            <div id="chat-messages" class="chat-messages"><div class="msg msg-ai" id="coach-welcome">üëã <strong>Atlas h√§r.</strong></div></div>
            <div class="chat-input-area"><input type="text" id="chat-input" placeholder="Fr√•ga Atlas..." class="flex-grow bg-black border border-stone-700 rounded-lg p-3 text-white focus:border-amber-500 outline-none" onkeypress="handleEnter(event)"><button onclick="sendChatMessage()" class="bg-amber-600 hover:bg-amber-500 text-black font-bold p-3 rounded-lg transition">‚û§</button></div>
        </div>
    </div>

    <div id="view-codex" class="w-full max-w-4xl mx-auto mt-24 px-4 hidden mb-20">
        <div class="text-center mb-12"><h2 class="text-4xl font-black text-white mb-2 tracking-tight">THE ATLAS CODEX</h2><p class="text-stone-400" id="codex-subtitle">Mastery through Simplification.</p></div>
        <div id="codex-content" class="space-y-8"></div>
    </div>

    <div id="view-cheatsheet" class="w-full max-w-5xl mx-auto mt-24 px-4 hidden mb-20">
        <div class="text-center mb-12"><h2 class="text-4xl font-black text-white mb-2 tracking-tight">ARCHITECT'S CHEAT SHEET</h2><p class="text-stone-400" id="cheat-subtitle">Your Logical Compass.</p></div>
        <div class="grid gap-12" id="cheat-content"></div>
    </div>

    <script>
        // ==========================================
        //  ATLAS CONFIG & DATA LAYER
        // ==========================================
        const langData = {
            sv: {
                nav_sim: "SIMULATOR", nav_exam: "EXAM MODE ‚è±Ô∏è", nav_coach: "AI COACH", nav_codex: "CODEX", nav_cheat: "LATHUND",
                btn_all: "ALLA", btn_core: "GRUND", btn_boss: "BOSS", btn_code: "KOD",
                label_mission: "UPPDRAG", label_intel: "INTEL", label_strategy: "STRATEGI",
                btn_next: "N√ÑSTA", btn_submit: "L√ÑMNA IN", btn_ai_gen: "NYTT SCENARIO",
                coach_sub: "St√§ll fr√•gor om DP-600. Jag pratar 'Mormors-spr√•k'.",
                coach_wel: "üëã <strong>Atlas h√§r.</strong> Jag √§r din externa hj√§rna. Fr√•ga mig om Fabric, DirectLake, eller be mig f√∂rklara T-SQL som om du vore 5 √•r.",
                coach_ph: "Fr√•ga Atlas...",
                codex_sub: "Bem√§stra genom f√∂renkling.",
                cheat_sub: "Din Logiska Kompass: 'Om X h√§nder -> G√∂r Y'",
                cheat_th_sc: "Scenario", cheat_th_sol: "L√∂sning", cheat_th_log: "Atlas Logik",
                label_atlas_says: "ATLAS S√ÑGER", label_senior: "Senior Arkitekt Tips", label_grandma: "Mormors-regeln",
                label_solution: "L√ñSNING", label_strategic_rules: "‚ö° Atlas Strategiska Tumregler",
                exam_start: "Starta Examen (50 fr√•gor)", exam_score: "Ditt Resultat: ", exam_pass: "GODK√ÑND üèÜ", exam_fail: "UNDERK√ÑND üíÄ"
            },
            en: {
                nav_sim: "SIMULATOR", nav_exam: "EXAM MODE ‚è±Ô∏è", nav_coach: "AI COACH", nav_codex: "CODEX", nav_cheat: "CHEAT SHEET",
                btn_all: "ALL", btn_core: "CORE", btn_boss: "BOSS", btn_code: "CODE",
                label_mission: "MISSION", label_intel: "INTEL", label_strategy: "STRATEGY",
                btn_next: "NEXT", btn_submit: "SUBMIT EXAM", btn_ai_gen: "NEW SCENARIO",
                coach_sub: "Ask me anything about DP-600. I speak 'Grandma'.",
                coach_wel: "üëã <strong>Atlas here.</strong> I am your external brain. Ask me about Fabric, DirectLake, or ask me to explain T-SQL like you're 5.",
                coach_ph: "Ask Atlas...",
                codex_sub: "Mastery through Simplification.",
                cheat_sub: "Your Logical Compass: 'If X happens -> Do Y'",
                cheat_th_sc: "Scenario", cheat_th_sol: "Solution", cheat_th_log: "Atlas Logic",
                label_atlas_says: "ATLAS SAYS", label_senior: "Senior Architect Tip", label_grandma: "The Grandma Rule",
                label_solution: "SOLUTION", label_strategic_rules: "‚ö° Atlas Strategic Rules",
                exam_start: "Start Exam (50 Qs)", exam_score: "Your Score: ", exam_pass: "PASSED üèÜ", exam_fail: "FAILED üíÄ"
            }
        };

        const questionBank = [
            // --- BATCH 1-8 COMPLETE (120+ QUESTIONS) ---
            { id: 1, type: "core", cat: "Fabric Capacity", icon: "ü™£", q: "Vad √§r 'Bursting'?", scenario: "CPU-anv√§ndningen sl√•r i taket kl 09:00, men ingen strypning sker. Hur?", opts: ["Fri prestanda", "L√•nar fr√•n framtiden", "Cache-minne", "Ingen gr√§ns"], correct: 1, senior: "Bursting l√•nar resurser, men det √§r 'Smoothing' som smetar ut fakturan √∂ver 24h f√∂r att undvika omedelbar strypning.", grandma: "Det √§r som ett kreditkort. Du kan k√∂pa en dyr TV (tung query) nu, men du m√•ste betala av skulden senare." },
            { id: 2, type: "core", cat: "OneLake", icon: "üîó", q: "Analysera S3-data?", scenario: "Kunden har 50TB i AWS. Vill anv√§nda Fabric men v√§grar betala f√∂r migrering.", opts: ["Copy Activity", "Shortcuts", "Mirroring", "G√•r ej"], correct: 1, senior: "Shortcuts virtualiserar datat. Metadata i OneLake, men bitarna ligger kvar i S3. Zero Copy.", grandma: "Skapa en genv√§g p√• skrivbordet. Filen ligger kvar i mappen, men du √∂ppnar den h√§rifr√•n." },
            { id: 3, type: "core", cat: "Security", icon: "üîë", q: "Vem ska vara 'Contributor'?", scenario: "En s√§ljare ska BARA kunna l√§sa rapporter, inget annat.", opts: ["Contributor", "Member", "Viewer", "Admin"], correct: 2, senior: "Contributor kan redigera/radera. Viewer ger strikt 'Read Only' och aktiverar RLS.", grandma: "Ge inte husnyckeln (Contributor) till n√•gon som bara ska titta genom f√∂nstret (Viewer)." },
            { id: 4, type: "core", cat: "Git Integration", icon: "üß¨", q: "Vilket filformat?", scenario: "Du kopplar Workspace till Azure DevOps. Hur sparas rapporterna?", opts: [".pbix", ".bim", ".pbip (Project)", ".zip"], correct: 2, senior: "Fabric anv√§nder PBIP som sparar definitioner i text/JSON, vilket m√∂jligg√∂r diff och merge.", grandma: "Ist√§llet f√∂r en limmad bok (PBIX) f√•r du en p√§rm med l√∂sa blad (JSON) som kan bytas ut ett och ett." },
            { id: 5, type: "core", cat: "Admin Portal", icon: "üõë", q: "Stoppa anv√§ndare att skapa items?", scenario: "Du vill hindra alla fr√•n att skapa nya Workspaces.", opts: ["Kapacitetsinst√§llning", "Tenant Setting", "Workspace Setting", "AD Group"], correct: 1, senior: "Tenant Settings √§r den globala switchen. Kan begr√§nsas till specifika s√§kerhetsgrupper.", grandma: "Huvudstr√∂mbrytaren i proppsk√•pet styr hela huset, inte bara ett rum." },
            { id: 6, type: "core", cat: "Deployment Pipelines", icon: "üöÄ", q: "Synka Dev till Test?", scenario: "Du har gjort √§ndringar i Dev. Hur f√•r du √∂ver dem till Test s√§krast?", opts: ["Manuell uppladdning", "Deployment Pipeline", "Copy Paste", "Save As"], correct: 1, senior: "Deployment Pipelines hanterar metadata-flytt och parameter-regler (t.ex. byta connection string).", grandma: "Som ett l√∂pande band i fabriken. En knapptryckning flyttar bilen fr√•n montering (Dev) till lackering (Test)." },
            { id: 7, type: "core", cat: "Fabric Domains", icon: "üè∑Ô∏è", q: "Varf√∂r anv√§nda Dom√§ner?", scenario: "En stor organisation har data f√∂r HR, Finans och S√§lj i en enda r√∂ra.", opts: ["B√§ttre prestanda", "Logisk gruppering & Governance", "Kr√§vs f√∂r Copilot", "Billigare"], correct: 1, senior: "Dom√§ner till√•ter decentraliserat √§garskap. HR kan vara admin f√∂r sina workspaces, Finans f√∂r sina.", grandma: "Ist√§llet f√∂r en stor l√•da med alla leksaker, har vi en l√•da f√∂r Lego (HR) och en f√∂r Bilar (Finans)." },
            { id: 8, type: "core", cat: "Capacity Metrics", icon: "üìä", q: "Hitta 'Noisy Neighbor'?", scenario: "Hela kapaciteten √§r l√•ngsam. En specifik rapport drar 90% CPU.", opts: ["Task Manager", "Capacity Metrics App", "Power BI Admin", "Fr√•ga anv√§ndarna"], correct: 1, senior: "Metrics App visar exakt vilken 'Item' (Rapport/Notebook) som konsumerar CU √∂ver tid.", grandma: "Vem √§ter upp all t√•rta? Kolla √∂vervakningskameran (Metrics App) f√∂r att hitta den skyldige." },
            { id: 9, type: "core", cat: "Storage Modes", icon: "üíæ", q: "Dyr lagring?", scenario: "Du f√•r slut p√• lagringsutrymme i din F64 kapacitet.", opts: ["K√∂p mer RAM", "Lagring √§r separat fr√•n Compute", "Radera rapporter", "Uppgradera till F128"], correct: 1, senior: "F-SKU betalar f√∂r Compute (CU). Lagring (OneLake) debiteras separat per GB (som ADLSg2).", grandma: "Hyran f√∂r l√§genheten (Compute) √§r en sak. Kostnaden f√∂r m√∂blerna du st√§ller in (Lagring) √§r en annan." },
            { id: 10, type: "core", cat: "Workspaces", icon: "üè†", q: "Ta bort Workspace?", scenario: "Du raderar ett Workspace. Vad h√§nder med datat i OneLake?", opts: ["Raderas direkt", "Soft Delete (Retention)", "Flyttas till Root", "Arkiveras f√∂r evigt"], correct: 1, senior: "Det hamnar i 'Soft Delete'. Kan √•terst√§llas inom en viss tid (ofta 7-30 dagar beroende p√• config).", grandma: "Det hamnar i papperskorgen f√∂rst. Du kan √•ngra dig innan sopbilen kommer." },
            { id: 11, type: "core", cat: "DirectLake Fallback", icon: "üöß", q: "Varf√∂r Fallback?", scenario: "DirectLake st√§ngs av. Du har lagt RLS i SQL Endpointen.", opts: ["Bug", "SQL RLS triggar Fallback", "St√∂ds ej", "Fel format"], correct: 1, senior: "S√§kerhet (SQL RLS) blockerar direktl√§sning. Notera att √§ven komplexa DAX-vyes kan trigga fallback.", grandma: "L√•s p√• ytterd√∂rren (SQL) tvingar vakten att √∂ppna. L√•s p√• glas√∂gonen (Modellen) l√•ter dig g√• rakt in." },
            { id: 12, type: "core", cat: "Medallion", icon: "üßπ", q: "Var tv√§tta data?", scenario: "R√•data i Bronze. Beh√∂ver ta bort dubbletter.", opts: ["Bronze", "Silver", "Gold", "PBI"], correct: 1, senior: "Silver = Engineering (Clean, Type, Dedupe). Bronze = History. Gold = Aggregation.", grandma: "Bronze = Matkassar p√• bordet. Silver = Skala/Hacka. Gold = Serverad middag." },
            { id: 13, type: "core", cat: "V-Order", icon: "üìö", q: "Vad g√∂r V-Order?", scenario: "Du aktiverar V-Order p√• alla tabeller. Vad √§r trade-offen?", opts: ["L√•ngsammare skrivning", "L√•ngsammare l√§sning", "Mer lagring", "S√§mre s√§kerhet"], correct: 0, senior: "V-Order maximerar L√ÑS-hastighet (PBI) genom att sortera och komprimera h√•rt, men det g√∂r SKRIV-operationer l√•ngsammare.", grandma: "Det tar l√§ngre tid att sortera bokhyllan perfekt (skriva), men det g√•r supersnabbt att hitta boken sen (l√§sa)." },
            { id: 14, type: "core", cat: "Copy vs Dataflow", icon: "üöö", q: "Flytta 10TB data?", scenario: "Ingen transformation, bara flytt.", opts: ["Dataflow", "Copy Activity", "Notebook", "Stored Proc"], correct: 1, senior: "Copy Activity √§r optimerad f√∂r bin√§r throughput. Dataflows parsear rader (l√•ngsamt).", grandma: "Flytta bohaget? Anv√§nd lastbil (Copy), inte personbil (Dataflow)." },
            { id: 15, type: "core", cat: "SQL Endpoint", icon: "üëÄ", q: "Skriva med SQL?", scenario: "INSERT INTO i Lakehouse SQL Endpoint.", opts: ["G√•r bra", "Read-Only", "Kr√§ver Admin", "Bara Views"], correct: 1, senior: "Lakehouse SQL Endpoint √§r Read-Only. Anv√§nd Warehouse f√∂r T-SQL DML.", grandma: "Skyltf√∂nster (Lakehouse SQL) vs Verkstad (Warehouse)." },
            { id: 16, type: "core", cat: "Spark Utils", icon: "üîß", q: "Lista filer i Notebook?", scenario: "Du vill se filer i en mapp med PySpark.", opts: ["ls -l", "mssparkutils.fs.ls", "os.listdir", "spark.list"], correct: 1, senior: "MSSparkUtils √§r det inbyggda biblioteket f√∂r filsystem-operationer i Fabric.", grandma: "Fabric har en egen schweizisk arm√©kniv (MSSparkUtils) f√∂r filhantering." },
            { id: 17, type: "core", cat: "Dataflows Gen2", icon: "üåä", q: "Spara till SQL DB?", scenario: "Du vill skriva resultatet av ett fl√∂de till en Azure SQL DB.", opts: ["G√•r ej", "Data Destination", "Export to CSV", "Copy Activity"], correct: 1, senior: "Data Destination (tidigare Output Dest) l√•ter dig skriva till Sinks som Lakehouse, Warehouse, SQL DB.", grandma: "R√∂ret m√•ste ha ett utlopp. Data Destination best√§mmer var vattnet (datat) hamnar." },
            { id: 18, type: "core", cat: "Notebook Scheduling", icon: "‚è∞", q: "K√∂ra Notebook varje natt?", scenario: "Du har en PySpark-kod som m√•ste k√∂ras 03:00.", opts: ["Windows Scheduler", "Pipeline Schedule", "Notebook Settings", "Manuellt"], correct: 1, senior: "L√§gg Notebooken i en Pipeline. S√§tt en Schedule Trigger p√• Pipelinen.", grandma: "Notebooken √§r en artist. Pipelinen √§r turn√©ledaren som s√§ger n√§r det √§r dags att g√• p√• scen." },
            { id: 19, type: "core", cat: "Delta Tables", icon: "‚è≥", q: "√Öngra en radering?", scenario: "Du r√•kade radera data i en Delta-tabell. Hur f√•r du tillbaka den?", opts: ["Backup restore", "Time Travel", "G√•r ej", "Ctrl+Z"], correct: 1, senior: "Delta beh√•ller historik. Anv√§nd `TIMESTAMP AS OF` eller `VERSION AS OF` f√∂r att l√§sa gammal data.", grandma: "Delta-tabeller √§r som en tidsmaskin. Du kan alltid √•ka tillbaka till hur det s√•g ut ig√•r." },
            { id: 20, type: "core", cat: "Optimize", icon: "üßπ", q: "M√•nga sm√• filer?", scenario: "Prestandan √§r d√•lig. Du har tusentals pyttesm√• Parquet-filer.", opts: ["VACUUM", "OPTIMIZE", "DELETE", "MERGE"], correct: 1, senior: "OPTIMIZE 'bin-packs' sm√• filer till st√∂rre, effektiva filer. VACUUM tar bort gamla versioner.", grandma: "St√§da rummet. L√§gg alla sm√• lego-bitar i en stor l√•da (Optimize) s√• hittar du l√§ttare." },
            { id: 101, type: "boss", cat: "Spark Skew", icon: "‚öñÔ∏è", q: "Jobbet h√§nger p√• 99%?", scenario: "Spark-jobbet k√∂r snabbt i b√∂rjan men sista tasken tar 4 timmar.", opts: ["√ñka minnet", "Data Skew", "N√§tverksfel", "Uppdatera Spark"], correct: 1, senior: "Data Skew inneb√§r att en partition √§r mycket st√∂rre √§n andra. Anv√§nd 'Salting' eller Adaptive Query Execution (AQE).", grandma: "En kassa i aff√§ren har 100 kunder i k√∂ (Skew), de andra har ingen. Det spelar ingen roll hur snabb kass√∂rskan √§r." },
            { id: 102, type: "boss", cat: "DirectLake Limitations", icon: "‚õî", q: "Vyer i DirectLake?", scenario: "Du skapar en SQL View i Warehouset som joinar 3 tabeller. Power BI DirectLake √§r l√•ngsamt.", opts: ["Views st√∂ds ej", "Det √§r snabbt", "Fallback till DQ", "M√•ste vara Materialized"], correct: 2, senior: "DirectLake kan inte l√§sa komplexa SQL-vyer direkt. Den m√•ste g√∂ra Fallback till DirectQuery f√∂r att SQL-motorn ska processa vyn.", grandma: "Om du skriver instruktionerna p√• ett spr√•k (SQL View) som l√§saren (DirectLake) inte kan, m√•ste de anlita en tolk (DirectQuery)." },
            { id: 103, type: "boss", cat: "Ordering vs Sorting", icon: "üìö", q: "Sort inom Partition?", scenario: "Du vill optimera 'Predicate Pushdown' f√∂r datum-filter i Spark.", opts: ["ORDER BY", "SORT WITHIN PARTITIONS", "CLUSTER BY", "GROUP BY"], correct: 1, senior: "`SORT WITHIN PARTITIONS` sorterar datat inuti varje fil, vilket g√∂r att Parquet footer-statistiken (Min/Max) blir effektivare f√∂r skipping.", grandma: "Sortera varje kapitel f√∂r sig. D√• vet du direkt om datumet du s√∂ker finns i just det kapitlet." },
            { id: 104, type: "boss", cat: "Variable Evaluation", icon: "üì¶", q: "DAX VAR f√§lla?", scenario: "VAR x = [Sales]. RETURN CALCULATE(x, ALL(Date)). Filtret tas inte bort.", opts: ["Bug i DAX", "Variabler √§r konstanter", "Fel syntax", "Anv√§nd EARLIER"], correct: 1, senior: "Variabler utv√§rderas N√ÑR DE DEFINIERAS, inte n√§r de anv√§nds. Kontexten √§r l√•st vid definitionstillf√§llet.", grandma: "Om du tar ett foto av himlen (VAR) p√• natten, kommer det fotot alltid vara m√∂rkt √§ven om du tittar p√• det p√• dagen (RETURN)." },
            { id: 105, type: "boss", cat: "Cross-Tenant", icon: "üåê", q: "Dela data externt?", scenario: "Dela en Power BI rapport med ett annat f√∂retag (B2B). RLS m√•ste fungera.", opts: ["G√•r ej", "Bjud in som Guest", "Skicka PBIX", "Public to Web"], correct: 1, senior: "Externa anv√§ndare (Entra ID Guest) kan se rapporter, och RLS fungerar om du mappar deras externa email (UPN) i s√§kerhetstabellen.", grandma: "G√§sten f√•r en bes√∂ksbricka. D√∂rrvakten (RLS) kollar brickan och ser att de bara f√•r g√• till konferensrummet." },
            { id: 106, type: "boss", cat: "Shortcut Security", icon: "üõ°Ô∏è", q: "Vem best√§mmer access?", scenario: "Du skapar en Shortcut till en ADLS Gen2-mapp. F√•r anv√§ndarna tillg√•ng?", opts: ["Ja, automatiskt", "Nej, ACL i ADLS styr", "Ja, via OneLake", "Bara Admin"], correct: 1, senior: "Shortcuts anv√§nder 'Delegated Access'. Slutanv√§ndarens identitet (OAuth) passeras till ADLS. De m√•ste ha ACL-r√§ttigheter i k√§llan.", grandma: "Genv√§gen √§r bara en karta. Om d√∂rren till skattkammaren (ADLS) √§r l√•st, hj√§lper inte kartan." },
            { id: 107, type: "boss", cat: "OLS vs RLS", icon: "üôà", q: "G√∂mma en kolumn?", scenario: "HR vill att 'Salary' kolumnen ska vara helt osynlig f√∂r icke-chefer, inte bara tom.", opts: ["RLS", "OLS (Object Level)", "G√∂m i rapport", "Bryt ut tabell"], correct: 1, senior: "OLS (Object Level Security) tar bort metadata. F√∂r anv√§ndaren existerar inte kolumnen. OBS: Kan krascha rapporter som anv√§nder kolumnen.", grandma: "RLS stryker √∂ver texten med svart tusch. OLS river ut hela sidan ur boken." },
            { id: 108, type: "boss", cat: "Pipeline Parameters", icon: "üéöÔ∏è", q: "Parameter till Notebook?", scenario: "Skicka 'RunDate' fr√•n Data Pipeline till en Notebook-cell.", opts: ["Notebook.run(args)", "Widget", "Toggle parameter cell", "Global variable"], correct: 2, senior: "Markera cellen som 'Toggle parameter cell' i Notebooken. Pipelinen injicerar variabler som √∂verskriver standardv√§rdena.", grandma: "Notebooken har en ink√∂pslista. Pipelinen kan smyga ner en extra lapp i fickan innan du g√•r in i aff√§ren." },
            { id: 109, type: "boss", cat: "Concurrency Control", icon: "üö¶", q: "Max samtidiga k√∂rningar?", scenario: "Din pipeline triggas av 1000 filer samtidigt. API:et kraschar.", opts: ["√ñka Timeout", "Concurrency Limit", "Retry Policy", "Batching"], correct: 1, senior: "S√§tt 'Concurrency' i ForEach-loopen till t.ex. 10. Det k√∂ar upp k√∂rningarna ist√§llet f√∂r att bomba k√§llsystemet.", grandma: "Sl√§pp bara in 10 personer √•t g√•ngen p√• nattklubben, annars blir det kaos i baren." },
            { id: 110, type: "boss", cat: "Self-Hosted Gateway", icon: "üö™", q: "VNET Data?", scenario: "Fabric ska l√§sa data fr√•n en SQL Server bakom en brandv√§gg (On-prem).", opts: ["VPN", "On-Prem Gateway", "Trusted IP", "ExpressRoute"], correct: 1, senior: "Data Gateway kr√§vs f√∂r att 'tunnla' in trafik fr√•n Fabric (molnet) till ett skyddat n√§tverk.", grandma: "En s√§ker lucka i muren. Du kan inte g√• in, men Gatewayen kan skicka ut paket till dig." },
            { id: 111, type: "boss", cat: "JSON Handling", icon: "üìú", q: "Parse JSON i T-SQL?", scenario: "Du har en kolumn med JSON-text i Warehouset. Du vill extrahera ett v√§rde.", opts: ["SUBSTRING", "JSON_VALUE", "OPENXML", "Regex"], correct: 1, senior: "`JSON_VALUE(col, '$.property')` √§r det optimerade s√§ttet att extrahera skal√§ra v√§rden ur JSON i Fabric DW.", grandma: "Anv√§nd en pincett (JSON_VALUE) f√∂r att plocka ut russinet ur kakan, smula inte s√∂nder hela kakan." },
            { id: 112, type: "boss", cat: "Statistics", icon: "üìä", q: "Gammal statistik?", scenario: "Queryn var snabb ig√•r, l√•ngsam idag. Datan har √§ndrats mycket.", opts: ["Rebuild Index", "Update Statistics", "Clear Cache", "Starta om"], correct: 1, senior: "SQL-optimizern beh√∂ver uppdaterad statistik f√∂r att v√§lja r√§tt plan. I Fabric sker detta oftast auto, men kan kr√§va manuell `UPDATE STATISTICS`.", grandma: "GPS:en tror att v√§gen √§r tom (gammal stats), men det √§r k√∂. Uppdatera kartan s√• v√§ljer den en annan v√§g." },
            { id: 113, type: "boss", cat: "Transaction Log", icon: "üìù", q: "Full Log?", scenario: "En massiv DELETE operation fyller transaktionsloggen och felar.", opts: ["K√∂p mer disk", "K√∂r i batcher", "St√§ng av loggning", "Switch recovery model"], correct: 1, senior: "Fabric Warehouse hanterar loggar auto, men massiva transaktioner kan sl√• i taket. Dela upp i mindre batcher (WHILE loop).", grandma: "√Ñt inte hela elefanten i en tugga. Dela upp det s√• s√§tter du inte i halsen." },
            { id: 114, type: "boss", cat: "Pandas to Spark", icon: "üêº", q: "Pandas skalning?", scenario: "Du konverterar en Spark DF till Pandas DF f√∂r bearbetning. Det kraschar (OOM).", opts: ["√ñka Driver Memory", "Anv√§nd Spark Native", "Koalas", "Chunking"], correct: 1, senior: "`toPandas()` drar all data till Driver-noden (Single node). Pandas skalar inte. Anv√§nd PySpark functions eller Pandas-on-Spark API.", grandma: "F√∂rs√∂k inte h√§lla hela badkaret (Spark) ner i en liten hink (Pandas). Det rinner √∂ver." },
            { id: 115, type: "boss", cat: "Slow Write", icon: "üê¢", q: "M√•nga sm√• partitions?", scenario: "Du skriver data partitionerat p√• 'Timestamp' (ms). Det tar evigheter.", opts: ["Bra f√∂r l√§sning", "Too many small files", "√ñkar parallellitet", "Ingen p√•verkan"], correct: 1, senior: "√ñver-partitionering skapar miljoner sm√• filer. Metadata-hanteringen d√∂dar prestandan. Partitionera p√• 'Day' eller 'Month'.", grandma: "L√§gg inte varje risgryn i en egen liten p√•se. L√§gg dem i s√§ckar." },
            { id: 116, type: "boss", cat: "Dependency Hell", icon: "üï∏Ô∏è", q: "Bibliotekskonflikt?", scenario: "Ditt jobb kr√§ver 'numpy 1.2'. Fabric default √§r '1.5'. Koden kraschar.", opts: ["Avinstallera i koden", "Custom Environment", "Ignorera", "Skriv om koden"], correct: 1, senior: "Skapa en 'Custom Environment', l√•s versionerna i en requirements.txt, och tilldela milj√∂n till Workspacet.", grandma: "Om receptet kr√§ver gammaldags mj√∂lk, bygg ett eget skafferi (Environment) med r√§tt ingredienser." },
            { id: 117, type: "boss", cat: "Throttling", icon: "‚è≥", q: "HTTP 429 Error?", scenario: "Dina API-anrop fr√•n en Pipeline misslyckas med kod 429.", opts: ["Serverfel", "Too Many Requests", "Not Found", "Unauthorized"], correct: 1, senior: "Mottagarsystemet stryper dig. Implementera 'Exponential Backoff' (v√§nta l√§ngre och l√§ngre mellan f√∂rs√∂ken).", grandma: "Om d√∂rren √§r st√§ngd, banka inte oavbrutet. V√§nta en stund, sen knacka igen." },
            { id: 118, type: "boss", cat: "OneLake Explorer", icon: "üìÇ", q: "Filen syns inte?", scenario: "Du laddade upp en fil via Explorer, men den syns inte i Spark direkt.", opts: ["Sync Delay", "R√§ttigheter", "Fel mapp", "Starta om"], correct: 0, senior: "OneLake Explorer √§r en klient. Det kan vara n√•gra sekunders f√∂rdr√∂jning innan metadata synkas till Spark-klustret.", grandma: "Brevet √§r lagt i l√•dan, men postbilen har inte h√§mtat det √§n." },
            { id: 201, type: "code", cat: "SQL Security", icon: "üîí", q: "Dynamisk Maskering?", scenario: "Du m√•ste d√∂lja allt utom de sista 4 siffrorna i 'PhoneNumber'.<br>M√•lformat: <code>XXX-XXX-1234</code>.", opts: ["FUNCTION = 'partial(\"XXX-XXX-\", 0, 4)'", "FUNCTION = 'partial(0, \"XXX-XXX-\", 4, NULL)'", "FUNCTION = 'partial(0, 4, \"XXX-XXX-\")'", "FUNCTION = 'partial(0, \"XXX-XXX-\", 4)'"], correct: 3, senior: "T-SQL syntaxen √§r <code>partial(prefix_count, padding_string, suffix_count)</code>. Vi vill visa 0 tecken i b√∂rjan, l√§gga till 'XXX-XXX-', och visa 4 i slutet.", grandma: "Klipp bort b√∂rjan (0), klistra in en lapp (XXX), och spara svansen (4)." },
            { id: 202, type: "code", cat: "T-SQL Ingestion", icon: "üì•", q: "COPY INTO Syntax?", scenario: "Vilket kommando importerar Parquet-filer fr√•n OneLake till Warehouse snabbast?", opts: ["INSERT INTO dbo.Table SELECT * FROM 'https://...'", "COPY INTO dbo.Table FROM 'https://...' WITH (FILE_TYPE = 'PARQUET')", "BULK INSERT dbo.Table FROM 'https://...'", "LOAD DATA INFILE 'https://...'"], correct: 1, senior: "COPY INTO √§r det moderna, h√∂gpresterande kommandot f√∂r Fabric Warehouse. BULK INSERT √§r legacy SQL Server.", grandma: "Anv√§nd r√§tt verktyg. COPY INTO √§r en dammsugare f√∂r data, INSERT √§r en pincett." },
            { id: 203, type: "code", cat: "PySpark Save", icon: "üíæ", q: "Spara som Delta?", scenario: "Du har en DataFrame <code>df</code>. Hur sparar du den som en hanterad tabell i Lakehouse?", opts: ["df.write.format('delta').save('/Tables/MyTable')", "df.write.saveAsTable('MyTable')", "df.save.table('MyTable')", "INSERT INTO MyTable VALUES (df)"], correct: 1, senior: "<code>saveAsTable('Namn')</code> registrerar tabellen i metastoren och hanterar s√∂kv√§gen automatiskt. <code>save()</code> sparar bara filer.", grandma: "Att 'spara som tabell' √§r som att s√§tta in boken i bibliotekssystemet. Att bara 'spara' √§r att l√§gga boken p√• en hylla utan att ber√§tta f√∂r n√•gon." },
            { id: 204, type: "code", cat: "JSON Handling", icon: "üìú", q: "Extrahera JSON?", scenario: "Du har JSON i kolumnen <code>Attributes</code>: <code>{'color': 'red'}</code>. Hur h√§mtar du 'red' i T-SQL?", opts: ["SELECT Attributes->'color'", "SELECT JSON_VALUE(Attributes, '$.color')", "SELECT JSON_QUERY(Attributes, '$.color')", "SELECT GET_JSON(Attributes, 'color')"], correct: 1, senior: "<code>JSON_VALUE</code> extraherar ett skal√§rt v√§rde (text/nummer). <code>JSON_QUERY</code> extraherar ett objekt/array (mer JSON).", grandma: "JSON_VALUE plockar ut godiset ur papperet. JSON_QUERY ger dig hela p√•sen." },
            { id: 205, type: "code", cat: "Semantic Link", icon: "üîó", q: "L√§sa PBI i Python?", scenario: "Du vill l√§sa tabellen 'Sales' fr√•n ditt dataset 'MyDataset' med SemPy.", opts: ["fabric.read_table('MyDataset', 'Sales')", "pd.read_pbi('MyDataset', 'Sales')", "spark.read.dataset('MyDataset').table('Sales')", "sempy.fabric.read_table('MyDataset', 'Sales')"], correct: 3, senior: "Biblioteket heter <code>sempy</code>. Syntaxen √§r <code>sempy.fabric.read_table(dataset, table)</code>. Detta √§r unikt f√∂r Fabric.", grandma: "Du m√•ste anv√§nda r√§tt nyckel (sempy) f√∂r att √∂ppna d√∂rren mellan Python och Power BI." },
            { id: 206, type: "code", cat: "SQL Security", icon: "üìß", q: "Maskera E-post?", scenario: "Du vill maskera kolumnen 'Email' s√• att endast f√∂rsta bokstaven syns (t.ex. aXXX@XXXX.com). Vilken funktion?", opts: ["MASKED WITH (FUNCTION = 'email()')", "MASKED WITH (FUNCTION = 'partial(1, \"XXX@XXXX.com\", 0)')", "MASKED WITH (FUNCTION = 'default()')", "MASKED WITH (FUNCTION = 'hide_email()')"], correct: 0, senior: "T-SQL har en inbyggd <code>email()</code> funktion f√∂r DDM som automatiskt ger formatet 'aXXX@XXXX.com'. Du beh√∂ver inte bygga den manuellt.", grandma: "Anv√§nd den f√§rdiga st√§mpeln f√∂r e-post, rita inte √∂ver varje brev f√∂r hand." },
            { id: 207, type: "code", cat: "SQL Security", icon: "üé≤", q: "Slumpm√§ssig L√∂n?", scenario: "Du vill visa ett slumpm√§ssigt v√§rde mellan 10000 och 50000 f√∂r kolumnen 'Salary' f√∂r obeh√∂riga.", opts: ["MASKED WITH (FUNCTION = 'random(10000, 50000)')", "MASKED WITH (FUNCTION = 'rand(10000, 50000)')", "MASKED WITH (FUNCTION = 'default()')", "MASKED WITH (FUNCTION = 'partial(0, 0, 0)')"], correct: 0, senior: "Funktionen <code>random(min, max)</code> ers√§tter det riktiga v√§rdet med ett slumpm√§ssigt tal inom intervallet vid l√§sning.", grandma: "S√§tt en prislapp med ett hittep√•-pris s√• ingen vet vad det egentligen kostar." },
            { id: 208, type: "code", cat: "SQL Permissions", icon: "üëÅÔ∏è", q: "Se maskerad data?", scenario: "Anv√§ndaren 'Lily' beh√∂ver se de riktiga v√§rdena i en maskerad tabell. Vilket kommando?", opts: ["GRANT SELECT TO Lily", "GRANT ADMIN TO Lily", "GRANT UNMASK TO Lily", "ALTER USER Lily SET MASKING = OFF"], correct: 2, senior: "Beh√∂righeten <code>UNMASK</code> √§r den specifika nyckeln som l√•ter en anv√§ndare se genom maskeringen. <code>SELECT</code> r√§cker inte.", grandma: "Ge Lily r√∂ntgen-glas√∂gonen (UNMASK) s√• hon kan se genom den suddiga texten." },
            { id: 209, type: "code", cat: "SQL Security", icon: "üö´", q: "Column Level Security?", scenario: "Du vill helt hindra anv√§ndare fr√•n att ens se att kolumnen 'SSN' existerar (inte bara maskera den).", opts: ["Anv√§nd Dynamic Data Masking (default)", "GRANT SELECT ON Table(Col1, Col2) TO User", "CREATE VIEW utan SSN och ge access till Vyn", "B√•de B och C fungerar"], correct: 3, senior: "CLS (Column Level Security) implementeras ofta genom att ge <code>GRANT SELECT</code> p√• specifika kolumner eller genom Vyer. DDM d√∂ljer bara v√§rdet, inte kolumnen.", grandma: "Maskering suddar ut texten. CLS klipper bort hela kolumnen fr√•n pappret." },
            { id: 210, type: "code", cat: "Row Level Security", icon: "üïµÔ∏è", q: "RLS Predicate?", scenario: "Du skapar en s√§kerhetspolicy. Vilken funktion filtrerar rader baserat p√• vem som fr√•gar?", opts: ["USER_NAME() = Region", "SUSER_SNAME()", "SESSION_USER", "Alla ovan kan anv√§ndas beroende p√• kontext"], correct: 3, senior: "I T-SQL f√∂r Fabric Warehouse anv√§nds ofta systemfunktioner som <code>USER_NAME()</code>, <code>SUSER_SNAME()</code> eller <code>SESSION_USER</code> i predikat-funktionen f√∂r att matcha mot data.", grandma: "Vakten kollar ID-kortet (System Function) och j√§mf√∂r namnet med g√§stlistan." },
            { id: 301, type: "boss", cat: "Licensing", icon: "üí≥", q: "Gratis Consumers?", scenario: "Du har 350 anv√§ndare som bara ska l√§sa rapporter (inga licenser). Vilken F-SKU √§r minimum?", opts: ["F32", "F64", "F128", "PPU"], correct: 1, senior: "F64 √§r den magiska gr√§nsen. Det motsvarar P1. Allt under F64 kr√§ver att VARJE l√§sare har en Pro-licens.", grandma: "Om du hyr den stora bussen (F64) f√•r passagerarna √•ka gratis. I den lilla bilen (F32) m√•ste alla k√∂pa biljett." },
            { id: 302, type: "core", cat: "Scaling", icon: "üìà", q: "Var skalar du upp?", scenario: "Prestandan √§r d√•lig. Du beh√∂ver dubbla din Fabric Capacity. Var klickar du?", opts: ["Fabric Admin Portal", "Workspace Settings", "Azure Portal", "Power BI Settings"], correct: 2, senior: "Kapaciteten √§r en Azure-resurs. Du skapar, pausar och skalar den i Azure Portal, inte inne i Fabric.", grandma: "Du ringer hyresv√§rden (Azure) f√∂r att bygga ut huset, du g√∂r det inte genom att m√∂blera om i vardagsrummet (Fabric)." },
            { id: 303, type: "boss", cat: "Dataverse", icon: "üîó", q: "Dataverse Shortcut syns ej?", scenario: "Du f√∂rs√∂ker skapa en shortcut till Dataverse men tabellerna dyker inte upp.", opts: ["Byt region", "Aktivera 'Link to Fabric' i Power Apps", "Skapa en Pipeline", "Beh√∂righetsfel"], correct: 1, senior: "F√∂r Dataverse m√•ste du specifikt aktivera 'Link to Fabric' inne i Power Apps Maker Portal f√∂rst f√∂r att synka metadatan till OneLake.", grandma: "Du m√•ste √∂ppna d√∂rren inifr√•n huset (Power Apps) innan du kan g√• in utifr√•n." },
            { id: 304, type: "core", cat: "Dataflow Gen2", icon: "üèóÔ∏è", q: "Schema f√∂r Relationer?", scenario: "Du bygger en Dimension-tabell i Dataflow Gen2 som ska ha relationer. Vilket schema?", opts: ["Dynamic Schema", "Fixed Schema", "Star Schema", "Snowflake Schema"], correct: 1, senior: "V√§lj 'Fixed Schema'. Dynamic Schema kan √§ndra kolumntyper vid n√§sta k√∂rning, vilket kraschar relationer i modellen.", grandma: "Gjut grunden i betong (Fixed) om du ska bygga hus p√• den. Om grunden r√∂r sig (Dynamic) rasar huset." },
            { id: 305, type: "boss", cat: "Dataflow Performance", icon: "üöÄ", q: "Staging f√∂r sm√• data?", scenario: "Du laddar 1000 rader dagligen via Dataflow Gen2. Det g√•r l√•ngsamt.", opts: ["Enable Staging", "Disable Staging", "Anv√§nd Gateway", "√ñka Compute"], correct: 1, senior: "F√∂r sm√• volymer, v√§lj 'Disable Staging'. Staging skriver till SQL/Lakehouse f√∂rst (overhead). Direkt-skrivning √§r snabbare f√∂r sm√• m√§ngder.", grandma: "Om du bara har ett brev, g√• direkt till brevl√•dan. Mellanlanda inte p√• postterminalen (Staging)." },
            { id: 401, type: "core", cat: "Eventhouse", icon: "‚ö°", q: "Hot vs Cold Cache?", scenario: "Du beh√∂ver extremt snabba svar p√• data fr√•n de senaste 24 timmarna. Data √§ldre √§n s√• anv√§nds s√§llan.", opts: ["Caching Policy", "Retention Policy", "Update Policy", "Sharding Policy"], correct: 0, senior: "Caching Policy styr vad som ligger p√• lokal SSD (Hot) vs Blob Storage (Cold). S√§tt Hot Cache till 1 dag f√∂r maximal prestanda.", grandma: "L√§gg dagens tidning p√• k√∂ksbordet (Hot) s√• du n√•r den direkt. L√§gg g√•rdagens i pappersinsamlingen i garaget (Cold)." },
            { id: 402, type: "code", cat: "KQL Syntax", icon: "‚å®Ô∏è", q: "Filtrera tid?", scenario: "Du vill se h√§ndelser fr√•n de senaste 30 minuterna i tabellen 'Logs'.", opts: ["Logs | where Timestamp > ago(30m)", "Logs | filter Timestamp > now() - 30m", "SELECT * FROM Logs WHERE Timestamp > DATEADD(m, -30, GETDATE())", "Logs | take 30m"], correct: 0, senior: "`ago()` √§r den mest optimerade funktionen i Kusto f√∂r tidsfiltrering. SQL-syntax fungerar inte native i KQL-fr√•gor.", grandma: "Att s√§ga 'f√∂r 30 minuter sedan' √§r enklare √§n att r√§kna ut exakt klockslag och subtrahera." },
            { id: 403, type: "boss", cat: "Eventstream", icon: "üåä", q: "Destinations?", scenario: "Du s√§tter upp en Eventstream. Du vill spara r√•data i Lakehouse OCH aggregerad data i KQL Database.", opts: ["Kr√§ver tv√• streams", "Multicast (flera destinationer)", "G√•r ej, v√§lj en", "Anv√§nd Data Pipeline"], correct: 1, senior: "Fabric Eventstreams st√∂der flera samtidiga destinationer. Du kan grena str√∂mmen: en 'r√•' till Lakehouse (Delta) och en 'processad' till Eventhouse.", grandma: "Du kan koppla b√•de en vattenslang (Lakehouse) och en sprinkler (KQL) till samma kran." },
            { id: 404, type: "core", cat: "Materialized Views", icon: "üèóÔ∏è", q: "Varf√∂r Materialized View?", scenario: "Du har miljoner IoT-signaler per sekund men beh√∂ver bara veta 'Max temperatur per timme' i din rapport.", opts: ["Snabbare Ingestion", "Deduplicering & Aggregering vid skrivning", "Sparar diskutrymme", "Kr√§vs f√∂r Power BI"], correct: 1, senior: "Materialized Views i KQL ber√§knar aggregeringen (Max, Count, Sum) vid ingestion-tillf√§llet. Queryn l√§ser sen mot det f√§rdiga resultatet, vilket ger millisekund-svar.", grandma: "Ist√§llet f√∂r att r√§kna alla mynt i spargrisen varje g√•ng du vill veta summan, skriver du upp summan p√• en lapp varje g√•ng du l√§gger i ett mynt." },
            { id: 405, type: "boss", cat: "Update Policy", icon: "üîÑ", q: "ETL i Real-tid?", scenario: "N√§r data landar i 'RawTable' vill du automatiskt transformera och flytta den till 'CleanTable'.", opts: ["Dataflow Gen2", "Notebook Trigger", "Update Policy", "Stored Procedure"], correct: 2, senior: "Update Policy √§r en funktion som triggas automatiskt n√§r data appendas till k√§lltabellen. Det √§r Kustos s√§tt att g√∂ra ELT med noll latens.", grandma: "En automatisk sorteringsmaskin. S√• fort brevet landar i l√•dan (Raw), √∂ppnas det och sorteras in i r√§tt fack (Clean)." },
            { id: 406, type: "code", cat: "KQL Operators", icon: "‚ûï", q: "Skapa ny kolumn?", scenario: "Du vill ber√§kna 'Total = Pris * Antal' i din queryresultat.", opts: ["project Total = Pris * Antal", "extend Total = Pris * Antal", "create column Total", "select Pris * Antal as Total"], correct: 1, senior: "`extend` l√§gger till en kolumn till de existerande. `project` v√§ljer ut specifika kolumner och kastar bort resten.", grandma: "Extend s√§tter en post-it lapp p√• dokumentet. Project klipper ut texten och kastar resten av pappret." },
            { id: 407, type: "boss", cat: "Eventhouse Capacity", icon: "üîã", q: "Auto-Scale?", scenario: "Din KQL Database f√•r en spik av trafik kl 18.00. Vad h√§nder?", opts: ["Den kraschar", "Auto-scale √§r p√• som default", "Manuell skalning kr√§vs", "Throttling sker direkt"], correct: 1, senior: "Eventhouse i Fabric har inbyggd auto-scale. Den allokerar fler compute-enheter vid behov och skalar ner n√§r det lugnar sig, utan att du lyfter ett finger.", grandma: "Buff√©n √∂ppnar fler kassor n√§r k√∂n v√§xer och st√§nger dem n√§r det blir tomt." },
            { id: 408, type: "core", cat: "Reflex (Activator)", icon: "üîî", q: "Trigga en Teams-alert?", scenario: "Om temperaturen > 100 grader i Eventstreamen, skicka ett meddelande till tekniker.", opts: ["Power Automate", "Data Activator (Reflex)", "Logic Apps", "Notification Hub"], correct: 1, senior: "Data Activator √§r designad f√∂r att 'lyssna' p√• data i realtid och agera (skicka mail, Teams, starta Fabric items) n√§r villkor m√∂ts.", grandma: "En vakthund. Om den ser en inbrottstjuv (>100 grader) sk√§ller den (Teams)." },
            { id: 409, type: "code", cat: "KQL Join", icon: "üîó", q: "Join Prestanda?", scenario: "Du ska joina en enorm tabell 'Fact' (10B rader) med en liten tabell 'Dim' (100 rader).", opts: ["Fact | join kind=inner (Dim)", "Dim | join kind=inner (Fact)", "Fact | lookup Dim", "Spelar ingen roll"], correct: 2, senior: "Anv√§nd `lookup` n√§r h√∂gra tabellen √§r liten (dimension). Det √§r optimerat f√∂r broadcast join. Om du anv√§nder `join`, ha alltid den minsta tabellen till V√ÑNSTER (eller anv√§nd hint.strategy=broadcast).", grandma: "Det √§r l√§ttare att h√•lla den lilla ink√∂pslistan i handen (Dim) och leta i den stora butiken (Fact), √§n tv√§rtom." },
            { id: 410, type: "boss", cat: "Series Analysis", icon: "üìà", q: "Hitta anomalier?", scenario: "Du vill uppt√§cka avvikelser i webbtrafik √∂ver tid med KQL.", opts: ["Bygg en ML-modell i Python", "series_decompose_anomalies()", "G√∂r en Average Group By", "Exportera till Excel"], correct: 1, senior: "KQL har inbyggda ML-funktioner f√∂r tidsserier. `series_decompose_anomalies` kan hitta spikar och dalar direkt i queryn.", grandma: "KQL har ett inbyggt mikroskop som ser bakterier (avvikelser) som det blotta √∂gat missar." },
            { id: 411, type: "core", cat: "OneLake Availability", icon: "üìÇ", q: "KQL data i OneLake?", scenario: "Du har sparat data i en KQL Database. Kan Spark l√§sa den?", opts: ["Nej, den √§r l√•st", "Ja, om du aktiverar OneLake Availability", "Bara via API", "Endast med Shortcut"], correct: 1, senior: "Aktivera 'OneLake Availability' p√• KQL-tabellen s√• sparas datat i Delta Parquet-format, vilket g√∂r det direkt l√§sbart f√∂r Spark och SQL Engines.", grandma: "Om du skriver dagboken p√• esperanto (KQL Native) kan ingen l√§sa. Om du skriver p√• engelska (Delta Parquet) kan alla f√∂rst√•." },
            { id: 412, type: "code", cat: "KQL Aggregation", icon: "‚àë", q: "Binning av tid?", scenario: "Du vill rita en graf som visar antal events per 5 minuter.", opts: ["summarize count() by Timestamp", "summarize count() by bin(Timestamp, 5m)", "group by Timestamp step 5m", "project Timestamp, count()"], correct: 1, senior: "`bin(kolumn, storlek)` avrundar tiden till n√§rmaste intervall. N√∂dv√§ndigt f√∂r alla tidsserie-grafer.", grandma: "Ist√§llet f√∂r att r√§kna varje droppe regn (exakt tid), st√§ller vi ut hinkar och m√§ter hur mycket som kommit var 5:e minut." },
            { id: 413, type: "boss", cat: "Retention Limit", icon: "üóëÔ∏è", q: "Hur l√§nge sparas data?", scenario: "Du s√§tter Retention Policy till 365 dagar. Vad h√§nder dag 366?", opts: ["Data arkiveras", "Data raderas (Hard Delete)", "Data flyttas till Cold Cache", "Du betalar extra"], correct: 1, senior: "N√§r retention-tiden g√•r ut raderas datat permanent fr√•n Eventhouse. Beh√∂ver du spara l√§ngre m√•ste du exportera det eller √§ndra policyn.", grandma: "N√§r b√§st-f√∂re-datumet g√•r ut sl√§nger butiken mj√∂lken. Den sparas inte p√• lagret." },
            { id: 414, type: "core", cat: "RTO/RPO", icon: "‚è±Ô∏è", q: "Disaster Recovery?", scenario: "En hel Azure-region g√•r ner. Hur skyddar du ditt Eventhouse?", opts: ["Backup/Restore", "Leader-Follower Architecture", "Det sker automatiskt", "RAID-5"], correct: 1, senior: "F√∂r aff√§rskritisk realtidsdata, s√§tt upp en 'Follower Database' i en annan region som speglar ledaren.", grandma: "Ha en kopia av husnyckeln hos grannen i n√§sta stad. Om ditt hus brinner upp har du fortfarande nyckeln." },
            { id: 415, type: "boss", cat: "Partitioning", icon: "üì¶", q: "Data Sharding?", scenario: "Prestandan dyker p√• en tabell med 100 miljarder rader. Hur optimerar du lagringen?", opts: ["Partitioning Policy", "Sharding Policy", "Indexing Policy", "Compression"], correct: 0, senior: "KQL partitionerar automatiskt p√• tid (IngestionTime). Du kan l√§gga till en 'Hash Partition Key' (t.ex. TenantId) f√∂r att gruppera data fysiskt och snabba upp s√∂kningar.", grandma: "Sortera biblioteket inte bara efter √•r (Tid), utan ocks√• efter genre (TenantId). D√• hittar du 'Deckare fr√•n 1990' direkt." },
            { id: 501, type: "core", cat: "Calculation Groups", icon: "üßÆ", q: "100 measures?", scenario: "Du har Sales, Cost, Margin. Du beh√∂ver YTD, QTD, MTD f√∂r alla tre. Ska du skapa 9 nya measures?", opts: ["Ja, det √§r best practice", "Nej, anv√§nd Calculation Groups", "Nej, anv√§nd Field Parameters", "Nej, anv√§nd Quick Measures"], correct: 1, senior: "Calculation Groups (via Tabular Editor eller native) till√•ter dig att applicera logik (t.ex. `CALCULATE(SELECTEDMEASURE(), DATESYTD(...))`) dynamiskt p√• alla measures.", grandma: "Ist√§llet f√∂r att k√∂pa en tidsmaskin till varje person (Measure), bygger vi en tidsmaskin (Calc Group) som vem som helst kan kliva in i." },
            { id: 502, type: "boss", cat: "Composite Models", icon: "üß©", q: "DirectLake + Excel?", scenario: "Du har en DirectLake-modell. Du l√§gger till en lokal Excel-fil i modellen (Composite). Vad h√§nder med prestandan?", opts: ["Ingen p√•verkan", "DirectLake blir Import", "DirectLake blir DirectQuery", "Excel blir DirectLake"], correct: 2, senior: "N√§r du blandar DirectLake med andra k√§llor (Composite Model) faller DirectLake tillbaka till DirectQuery-l√§ge (tr√∂gare), eftersom motorn inte kan garantera minneskonsistens √∂ver olika '√∂ar' av data.", grandma: "Du blandar olja (DirectLake) och vatten (Excel). De blandas inte, s√• motorn m√•ste k√∂ra l√•ngsamt och vispa hela tiden (DirectQuery)." },
            { id: 503, type: "code", cat: "DAX Context", icon: "context", q: "SUMX vs SUM?", scenario: "Du vill r√§kna ut 'Pris * Antal' f√∂r varje rad och sen summera. Vilken funktion?", opts: ["SUM(Pris * Antal)", "SUMX(Table, Pris * Antal)", "CALCULATE(SUM(Pris) * SUM(Antal))", "AVERAGEX(Table, Pris * Antal)"], correct: 1, senior: "`SUM` accepterar bara en kolumn. `SUMX` √§r en iterator som g√•r rad f√∂r rad, utf√∂r uttrycket, och sedan summerar. N√∂dv√§ndigt f√∂r 'Line Item' ber√§kningar.", grandma: "SUM √§r att v√§ga hela s√§cken potatis. SUMX √§r att ta upp varje potatis, tv√§tta den, v√§ga den, och sen l√§gga ihop vikterna." },
            { id: 504, type: "boss", cat: "Aggregations", icon: "‚õ∞Ô∏è", q: "Petabyte Dashboard?", scenario: "Du har 10 miljarder rader. Dashboarden m√•ste ladda p√• <1 sek. DirectQuery √§r f√∂r l√•ngsamt.", opts: ["Bygg en Kub", "User-Defined Aggregations", "Import Mode", "√ñka Capacity"], correct: 1, senior: "Skapa en aggregerad tabell (Import) som Power BI automatiskt tr√§ffar f√∂r 99% av fr√•gorna. Detaljfr√•gor g√•r vidare till DirectQuery (Detail Table).", grandma: "Ha en sammanfattning p√• f√∂rsta sidan (Agg). L√§s bara hela boken (Detail) om n√•gon fr√•gar om en specifik fotnot." },
            { id: 505, type: "code", cat: "DAX Variables", icon: "üì¶", q: "Varf√∂r anv√§nda VAR?", scenario: "<code>VAR x = [Sales] RETURN DIVIDE(x, [Budget])</code> vs att skriva [Sales] direkt.", opts: ["Bara f√∂r l√§sbarhet", "Prestanda & Debugging", "√Ñndrar scope", "Kr√§vs f√∂r CALCULATE"], correct: 1, senior: "Variabler ber√§knas EN g√•ng och lagras i minnet (Lazy Evaluation men cachad scope). Anropar du [Sales] tv√• g√•nger utan VAR ber√§knas den tv√• g√•nger.", grandma: "R√§kna pengarna en g√•ng och skriv upp summan (VAR). R√§kna inte om sedlarna varje g√•ng du ska k√∂pa n√•got." },
            { id: 506, type: "boss", cat: "XMLA Endpoint", icon: "üîå", q: "Deploya bara en tabell?", scenario: "Du har en gigantisk modell (10GB). Du vill bara uppdatera en measure, inte ladda upp hela filen igen.", opts: ["G√•r ej", "ALM Toolkit / Tabular Editor", "Power BI Desktop", "Deployment Pipelines"], correct: 1, senior: "Via XMLA-endpointen (Read/Write) kan verktyg som ALM Toolkit g√∂ra en 'Schema Diff' och bara pusha √§ndringarna (metadata), vilket tar sekunder ist√§llet f√∂r minuter.", grandma: "Byt bara ut den trasiga gl√∂dlampan, bygg inte om hela huset." },
            { id: 507, type: "core", cat: "Auto Date/Time", icon: "üìÖ", q: "Modellen √§r enorm?", scenario: "Din modell √§r 500MB men har lite data. Du ser massor av dolda tabeller med namn som 'LocalDateTable...'.", opts: ["Virus", "Auto Date/Time", "Systemtabeller", "Tempfiler"], correct: 1, senior: "St√§ng av 'Auto Date/Time'. Power BI skapar annars en dold datumtabell f√∂r VARJE datumkolumn, vilket bloatar minnet enormt. Anv√§nd en central Date Table.", grandma: "Power BI har smyg-kopierat kalendern f√∂r varje f√∂delsedag du skrivit upp. Kasta dem och anv√§nd en v√§ggkalender f√∂r allt." },
            { id: 508, type: "code", cat: "USERELATIONSHIP", icon: "üíû", q: "Order vs Ship Date?", scenario: "Du har en datumtabell kopplad till 'OrderDate'. Du vill visa 'ShipDate' i samma graf utan att √§ndra relationen.", opts: ["Kopiera datumtabellen", "USERELATIONSHIP", "CROSSFILTER", "LOOKUPVALUE"], correct: 1, senior: "`CALCULATE([Sales], USERELATIONSHIP(Fact[ShipDate], Date[Date]))` aktiverar en inaktiv relation under ber√§kningen.", grandma: "Normalt g√•r t√•get till Stockholm (Order). Med den h√§r biljetten (USERELATIONSHIP) kan t√•get tillf√§lligt g√• till G√∂teborg (Ship)." },
            { id: 509, type: "boss", cat: "Dynamic Format Strings", icon: "üí≤", q: "Valuta-v√§xlare?", scenario: "Anv√§ndaren v√§ljer 'USD' eller 'SEK'. Siffrorna √§ndras, men 'kr'-tecknet √§r kvar.", opts: ["Format String Expression", "Calculation Group", "B√•de A och B", "G√•r ej"], correct: 2, senior: "Du kan anv√§nda Dynamic Format Strings (DAX-uttryck f√∂r formatet) direkt p√• measuren, eller i en Calculation Group f√∂r att byta t.ex. '$ #,##0' mot '#,##0 kr'.", grandma: "Kameleont-text. Siffran √§r densamma, men kl√§derna (valutan) √§ndras beroende p√• vem som tittar." },
            { id: 510, type: "core", cat: "Cardinality", icon: "üìá", q: "Optimera minne?", scenario: "Vilken kolumn tar mest plats i VertiPaq: 'Gender' (2 v√§rden) eller 'TransactionID' (1M unika v√§rden)?", opts: ["Gender (Text tar plats)", "TransactionID (H√∂g kardinalitet)", "Samma", "Beror p√• datatypen"], correct: 1, senior: "H√∂g kardinalitet (m√•nga unika v√§rden) d√∂dar komprimeringen (Dictionary Encoding). `TransactionID` √§r oftast on√∂dig i analys; ta bort den eller splitta den.", grandma: "Det √§r l√§tt att packa 1000 r√∂da strumpor (L√•g kardinalitet). Det √§r sv√•rt att packa 1000 unika sn√∂flingor (H√∂g kardinalitet)." },
            { id: 511, type: "code", cat: "Iterator Rank", icon: "üèÜ", q: "RANKX prestanda?", scenario: "Du vill rangordna 1 miljon kunder baserat p√• f√∂rs√§ljning. `RANKX(All(Customers), [Sales])` √§r l√•ngsam.", opts: ["Anv√§nd TOPN", "Anv√§nd Window Functions", "RANKX(ALLSELECTED)", "Flytta till SQL"], correct: 1, senior: "Window Functions (som `WINDOW`, `OFFSET`, `INDEX`) i DAX √§r ofta mer performanta √§n iterativa `RANKX` f√∂r stora dataset eftersom de kan utnyttja sortering i cachen.", grandma: "Ist√§llet f√∂r att springa runt och j√§mf√∂ra dig med alla (RANKX), titta bara p√• listan som redan h√§nger p√• v√§ggen (Window)." },
            { id: 512, type: "boss", cat: "Bi-Directional", icon: "‚ÜîÔ∏è", q: "Farliga relationer?", scenario: "Du s√§tter 'Both' p√• Cross-filter direction f√∂r att f√• en slicer att funka. Vad √§r risken?", opts: ["Ingen risk", "Ambiguity & Prestanda", "Datat raderas", "Cirkul√§r referens"], correct: 1, senior: "Bi-directional filters kan skapa oavsiktliga v√§gar i modellen (Ambiguity) som ger fel siffror, och det tvingar motorn att g√∂ra dyra joins. Undvik om m√∂jligt.", grandma: "Om d√∂rren sv√§nger √•t b√•da h√•llen vet man aldrig vem som kommer in. H√•ll den enkelriktad f√∂r s√§kerhets skull." },
            { id: 513, type: "core", cat: "Visual Calculations", icon: "üëÅÔ∏è", q: "Running Total utan DAX?", scenario: "Du vill ha en l√∂pande summa i tabellen men orkar inte skriva komplex DAX.", opts: ["Quick Measure", "Visual Calculation", "Excel Export", "Calculated Column"], correct: 1, senior: "Visual Calculations till√•ter dig att skriva `RUNNINGSUM([Sales])` direkt i visualen. Det ber√§knas p√• den aggregerade matrisen, inte i modellen.", grandma: "R√§kna p√• fingrarna direkt vid bordet (Visual Calc) ist√§llet f√∂r att g√• in i k√∂ket och laga en ny r√§tt (DAX Measure)." },
            { id: 514, type: "boss", cat: "Snapshot Isolation", icon: "üì∏", q: "L√•ngsam refresh?", scenario: "Rapporten √§r blank medan datasetet uppdateras. Anv√§ndarna klagar.", opts: ["Incremental Refresh", "Query Caching", "Dataset Eviction", "Read/Write XMLA"], correct: 0, senior: "Vid uppdatering (Refresh) l√•ses ibland modellen. Med Incremental Refresh och partitionering kan Power BI h√•lla gamla data tillg√§nglig tills den nya partitionen √§r klar (Snapshot Isolation).", grandma: "Byt duken p√• bordet utan att ta bort tallrikarna. G√§sterna m√§rker ingenting." },
            { id: 515, type: "code", cat: "TREATAS", icon: "üé≠", q: "Virtuell Relation?", scenario: "Du har tv√• tabeller som inte √§r kopplade, men du vill filtrera den ena med den andra i en specifik measure.", opts: ["RELATED()", "TREATAS()", "USERELATIONSHIP()", "LOOKUPVALUE()"], correct: 1, senior: "`CALCULATE([Sales], TREATAS(VALUES(Table1[ID]), Table2[ID]))` skapar en 'lineage' mellan tabellerna dynamiskt. Det √§r en virtuell relation.", grandma: "L√•tsas att de h√§r tv√• personerna √§r sl√§kt, bara f√∂r den h√§r middagen (TREATAS)." },
            { id: 601, type: "boss", cat: "Spark Partitioning", icon: "üç∞", q: "Partitionera p√• ID?", scenario: "Du har 1 miljard rader. Du partitionerar p√• 'TransactionID'. Prestandan kraschar.", opts: ["Bra, snabb s√∂kning", "Small Files Problem", "Data Skew", "F√∂r lite minne"], correct: 1, senior: "Att partitionera p√• en kolumn med h√∂g kardinalitet (ID) skapar miljoner sm√• filer. Metadata-hanteringen (Driver) kv√§vs. Partitionera p√• l√•g kardinalitet (Datum/Land).", grandma: "L√§gg inte varje risgryn i en egen p√•se. L√§gg dem i s√§ckar m√§rkta med √•r." },
            { id: 602, type: "core", cat: "Broadcast Join", icon: "üì¢", q: "Joinar stor + liten tabell?", scenario: "Du joinar en 100GB tabell med en 10MB tabell. Hur optimerar du?", opts: ["Sort Merge Join", "Broadcast Hash Join", "Shuffle Hash Join", "Cartesian Product"], correct: 1, senior: "Spark skickar en kopia av den lilla tabellen (10MB) till alla noder (Broadcast). Detta eliminerar 'Shuffle' av den stora tabellen √∂ver n√§tverket.", grandma: "Ist√§llet f√∂r att alla 100 personer ska springa till anslagstavlan, ger vi alla en egen kopia av bladet i handen." },
            { id: 603, type: "code", cat: "Z-Ordering", icon: "üóÇÔ∏è", q: "Optimera s√∂kning p√• 2 kolumner?", scenario: "Du filtrerar ofta p√• b√•de 'Region' och 'Product'. Partitionering r√§cker inte.", opts: ["OPTIMIZE Table ZORDER BY (Region, Product)", "VACUUM Table", "REPARTITION(Region, Product)", "SORT BY Region"], correct: 0, senior: "Z-Ordering samlokaliserar relaterad data i samma filer, vilket g√∂r 'Data Skipping' extremt effektivt f√∂r flera kolumner samtidigt.", grandma: "Sortera biblioteket s√• att 'Svenska Deckare' st√•r tillsammans, inte bara 'Svenska' b√∂cker utspridda √∂verallt." },
            { id: 604, type: "boss", cat: "Spark Speculation", icon: "üîÆ", q: "En seg nod?", scenario: "99 tasks √§r klara, men 1 task h√§nger i evigheter p√• en l√•ngsam nod.", opts: ["D√∂da jobbet", "Aktivera Speculative Execution", "√ñka minnet", "Ignorera"], correct: 1, senior: "Speculative Execution startar samma task p√• en annan nod parallellt. Den som blir klar f√∂rst vinner, den andra d√∂das.", grandma: "Om en l√∂pare haltar, skicka in en reserv som springer samma str√§cka. Ta tiden p√• den som kommer i m√•l f√∂rst." },
            { id: 605, type: "code", cat: "Merge Schema", icon: "üß¨", q: "Schema Drift i Delta?", scenario: "Dina nya datafiler har en extra kolumn. Append-jobbet kraschar.", opts: [".option('mergeSchema', 'true')", ".mode('overwrite')", "Ignorera kolumnen", "Manuell ALTER TABLE"], correct: 0, senior: "Delta Lake st√∂der schema evolution. Med `mergeSchema` (eller `autoMerge` i config) uppdateras tabellens schema automatiskt.", grandma: "Om g√§sten har med sig en extra v√§n, duka fram en extra tallrik (MergeSchema) ist√§llet f√∂r att l√•sa d√∂rren." },
            { id: 606, type: "core", cat: "Spark UI", icon: "üñ•Ô∏è", q: "Identifiera Spill?", scenario: "Jobbet √§r l√•ngsamt. I Spark UI ser du 'Disk Bytes Spilled'.", opts: ["Bra, sparar RAM", "D√•ligt, minnet √§r slut", "N√§tverksproblem", "CPU bottleneck"], correct: 1, senior: "Spill inneb√§r att RAM inte r√§ckte till, s√• Spark skrev tempor√§r data till disken (l√•ngsamt). √ñka minnet eller minska partitionerna.", grandma: "Du kan inte h√•lla alla bollar i luften samtidigt, s√• du m√•ste l√§gga ner n√•gra p√• marken (Spill). Det tar tid att plocka upp dem igen." },
            { id: 607, type: "boss", cat: "Delta History", icon: "üìú", q: "St√§da historik?", scenario: "Din lagringskostnad skenar. Du har 2 √•rs historik i Delta Log.", opts: ["Radera _delta_log mappen", "VACUUM RETAIN 7 DAYS", "OPTIMIZE", "Drop Table"], correct: 1, senior: "`VACUUM` raderar fysiska filer som inte l√§ngre beh√∂vs av den senaste versionen (bortsett fr√•n retention-perioden). OBS: Om√∂jligg√∂r Time Travel l√§ngre bak √§n gr√§nsen.", grandma: "T√∂m papperskorgen. Du f√•r mer plats, men du kan inte l√§ngre √•ngra dig och fiska upp det du sl√§ngde f√∂rra veckan." },
            { id: 608, type: "code", cat: "PySpark UDF", icon: "üêå", q: "Python function i Spark?", scenario: "Du anv√§nder en standard Python-loop f√∂r att processa data rad f√∂r rad i en DataFrame.", opts: ["Snabbt", "Extremt l√•ngsamt (Serialization)", "B√§sta praxis", "Enda s√§ttet"], correct: 1, senior: "Standard Python UDFs tvingar data att flyttas mellan JVM och Python-processen (Pickling). Anv√§nd Pandas UDF (Vectorized) eller Native Spark Functions.", grandma: "Att √∂vers√§tta varje ord via en tolk (Python UDF) g√•r l√•ngsamt. Att tala spr√•ket direkt (Native Spark) g√•r snabbt." },
            { id: 609, type: "boss", cat: "High Concurrency", icon: "‚ö°", q: "Flera anv√§ndare, en session?", scenario: "10 analytiker k√∂r sm√• queries i samma Notebook. Starttiden √§r f√∂r l√•ng.", opts: ["Standard Session", "High Concurrency Mode (Livy)", "Egna kluster", "SQL Endpoint"], correct: 1, senior: "High Concurrency (delade sessioner) l√•ter flera anv√§ndare dela p√• samma Spark Context, vilket eliminerar uppstartstiden f√∂r varje person.", grandma: "Alla √•ker i samma buss (High Concurrency) ist√§llet f√∂r att alla ska starta varsin bil." },
            { id: 610, type: "code", cat: "Explode", icon: "üí•", q: "Array till rader?", scenario: "En kolumn inneh√•ller `['A', 'B', 'C']`. Du vill ha 3 rader.", opts: ["split()", "explode()", "flatten()", "array_contains()"], correct: 1, senior: "`explode()` tar en array och skapar en ny rad f√∂r varje element i arrayen. Varning: Kan √∂ka dataraderna exponentiellt.", grandma: "Spr√§ng pi√±atan (Explode). Varje godisbit som ramlar ut blir en egen liten h√∂g." },
            { id: 611, type: "core", cat: "Auto-Loader", icon: "‚òÅÔ∏è", q: "Ladda filer effektivt?", scenario: "Du f√•r 10 000 nya filer varje dag i S3. `spark.read` tar f√∂r l√•ng tid att lista dem.", opts: ["Copy Activity", "Auto Loader (cloudFiles)", "Manuellt", "Trigger"], correct: 1, senior: "Auto Loader (`format('cloudFiles')`) anv√§nder Notification Services (SNS/EventGrid) f√∂r att veta exakt vilka filer som √§r nya, utan att beh√∂va lista hela mappen.", grandma: "Ist√§llet f√∂r att leta igenom hela brevl√•dan varje g√•ng, v√§ntar vi p√• att flaggan f√§lls upp n√§r posten kommer." },
            { id: 612, type: "boss", cat: "Notebook Reference", icon: "üîó", q: "Anropa annan Notebook?", scenario: "Du har en 'Setup'-notebook med funktioner. Du vill anv√§nda dem i din analys.", opts: ["Kopiera koden", "%run ./Setup", "import setup", "mssparkutils.run()"], correct: 1, senior: "Magical command `%run` exekverar den andra notebooken i samma kontext. Variabler och funktioner blir tillg√§ngliga direkt.", grandma: "L√§s receptboken (Setup) innan du b√∂rjar laga mat, s√• vet du hur man g√∂r s√•sen." },
            { id: 613, type: "code", cat: "SCD Type 2", icon: "‚è≥", q: "Historikhantering?", scenario: "Kund byter adress. Du vill spara b√•de gamla och nya adressen med giltighetstider.", opts: ["Overwrite", "Append", "MERGE med logik", "Update"], correct: 2, senior: "SCD Type 2 kr√§ver en `MERGE` operation som st√§nger den gamla raden (s√§tter EndDate) och infogar den nya raden (s√§tter StartDate).", grandma: "Stryk inte √∂ver den gamla adressen i adressboken. Skriv den nya under och notera n√§r flytten skedde." },
            { id: 614, type: "boss", cat: "Data Skipping", icon: "‚è≠Ô∏è", q: "Hur funkar det?", scenario: "Spark l√§ser bara 1 av 10 filer trots att du s√∂ker i hela mappen.", opts: ["Indexering", "Min/Max Statistik i Footer", "Slumpen", "Caching"], correct: 1, senior: "Parquet/Delta lagrar Min/Max v√§rden f√∂r varje kolumn i filens metadata. Om ditt s√∂kv√§rde inte ryms inom intervallet, hoppar Spark √∂ver hela filen.", grandma: "Om det st√•r 'A-F' p√• p√§rmens rygg, beh√∂ver du inte √∂ppna den om du letar efter 'Zlatan'." },
            { id: 615, type: "core", cat: "Environment", icon: "üåç", q: "Spark Compute?", scenario: "Vad √§r en 'Spark Pool' i Fabric?", opts: ["Det finns inga Pooler", "Starter Pool & Custom Pool", "Serverless SQL", "Dataflow Compute"], correct: 1, senior: "I Fabric startar Starter Pools p√• sekunder (Live Pool). Du kan skapa Custom Pools f√∂r att specificera bibliotek, nodstorlek och autoscale-gr√§nser.", grandma: "Starter Pool √§r hyrbilen som st√•r redo. Custom Pool √§r din egen bil som du har trimmat och stylat precis som du vill." },
            { id: 701, type: "boss", cat: "Pipeline vs Dataflow", icon: "üîÄ", q: "N√§r anv√§nda vad?", scenario: "Du ska flytta data fr√•n A till B och samtidigt aggregera den.", opts: ["Pipeline Copy", "Dataflow Gen2", "Notebook", "Shortcut"], correct: 1, senior: "Pipelines √§r b√§st f√∂r kontrollfl√∂de och ren kopiering (Orchestration). Dataflow Gen2 √§r b√§st f√∂r visuell transformation (Low-code ETL).", grandma: "Pipeline √§r logistikchefen som flyttar l√•dor. Dataflow √§r arbetaren som √∂ppnar l√•dorna och bygger om inneh√•llet." },
            { id: 702, type: "code", cat: "Lookup Activity", icon: "üîé", q: "Begr√§nsning?", scenario: "Du vill h√§mta en lista med 10 000 tabellnamn via Lookup f√∂r att loopa √∂ver dem.", opts: ["Det funkar bra", "Max 5000 rader / 4MB", "Max 100 rader", "Kr√§ver Premium"], correct: 1, senior: "Lookup Activity har en h√•rd gr√§ns p√• 5000 rader eller 4MB payload. F√∂r st√∂rre listor, anv√§nd Copy till en fil eller Query i ForEach.", grandma: "Du kan bara b√§ra 5000 papper i h√§nderna. Beh√∂ver du fler m√•ste du h√§mta en vagn (annan l√∂sning)." },
            { id: 703, type: "core", cat: "Triggers", icon: "üî´", q: "Starta n√§r fil landar?", scenario: "S√• fort en CSV landar i ADLS Gen2 ska pipelinen starta.", opts: ["Schedule Trigger", "Tumbling Window", "Storage Event Trigger", "Manual Trigger"], correct: 2, senior: "Storage Event Trigger lyssnar p√• 'BlobCreated' h√§ndelser i Azure. Det √§r h√§ndelsestyrd arkitektur.", grandma: "D√∂rrklocka. N√§r n√•gon trycker p√• knappen (filen landar), √∂ppnar du d√∂rren (pipelinen startar)." },
            { id: 704, type: "boss", cat: "Expression Language", icon: "üó£Ô∏è", q: "Referera f√∂reg√•ende steg?", scenario: "Du vill anv√§nda output fr√•n 'Activity1' i 'Activity2'.", opts: ["@activity('Activity1').output.value", "Activity1.output", "@pipeline().Activity1", "#Activity1"], correct: 0, senior: "Dynamiskt inneh√•ll i Pipelines anv√§nder `@`-syntax. Output √§r oftast JSON.", grandma: "Du m√•ste peka exakt: 'Det som han d√§r borta sa' (@activity...output)." },
            { id: 705, type: "boss", cat: "Staging Area", icon: "üèóÔ∏è", q: "Copy fr√•n Oracle?", scenario: "Du kopierar fr√•n on-prem Oracle till Lakehouse. Varf√∂r aktivera Staging?", opts: ["S√§kerhet", "Prestanda & Kompatibilitet", "Billigare", "Kr√§vs alltid"], correct: 1, senior: "Staging (via Blob/ADLS) till√•ter parallell kopiering och hanterar formatkonvertering (t.ex. PolyBase) som direkt kopiering inte klarar.", grandma: "Mellanlanda p√• en lastkaj (Staging) f√∂r att lasta om fr√•n t√•g till lastbil, ist√§llet f√∂r att f√∂rs√∂ka k√∂ra t√•get p√• motorv√§gen." },
            { id: 706, type: "code", cat: "ForEach Parallel", icon: "bars", q: "K√∂ra sekventiellt?", scenario: "Du har en ForEach-loop som m√•ste k√∂ra tabellerna i ordning A -> B -> C.", opts: ["G√•r ej i ForEach", "Kryssa i 'Sequential'", "Batch Count = 1", "Anv√§nd Until Loop"], correct: 1, senior: "Default k√∂r ForEach parallellt (upp till 20 eller 50). Markera 'Sequential' f√∂r att tvinga dem att k√∂ra en i taget.", grandma: "En k√∂ i kassan (Sequential) vs alla rusar mot d√∂rren samtidigt (Parallel)." },
            { id: 707, type: "core", cat: "Get Metadata", icon: "üóÉÔ∏è", q: "Validera fil finns?", scenario: "Pipelinen f√•r inte krascha om filen saknas. Hur kollar du f√∂rst?", opts: ["If Condition", "Get Metadata + If Condition", "Try/Catch", "Validation Activity"], correct: 1, senior: "Anv√§nd Get Metadata med 'Exists' argumentet. Om false, hoppa √∂ver eller k√∂r en annan v√§g i en If Condition.", grandma: "Knacka p√• d√∂rren (Get Metadata). Om ingen svarar, g√• d√§rifr√•n. G√• inte bara rakt in." },
            { id: 708, type: "boss", cat: "Dataflow Gen2 Dest", icon: "üéØ", q: "Skriva till SQL?", scenario: "Du vill skriva resultatet av Dataflow Gen2 till en Azure SQL Databas.", opts: ["Kr√§ver Gateway", "Data Destination", "G√•r ej, bara Lakehouse", "Power BI Dataset"], correct: 1, senior: "Data Destination i Gen2 st√∂der nu Azure SQL, Lakehouse, KQL och Warehouse. Det ers√§tter gamla 'Output Destination'.", grandma: "Adresslappen p√• paketet. Du kan skicka det till sj√∂n (Lake) eller till lagret (SQL)." },
            { id: 709, type: "core", cat: "Pipeline Parameters", icon: "üéöÔ∏è", q: "√Öteranv√§ndbar Pipeline?", scenario: "Du vill anv√§nda samma pipeline f√∂r 10 olika tabeller.", opts: ["H√•rdkoda namn", "Pipeline Parameters", "Global Variables", "Environment Variables"], correct: 1, senior: "Definiera parametrar (TableName, Schema) i pipelinens inst√§llningar och skicka in v√§rdena vid k√∂rning (Trigger time).", grandma: "En blankett d√§r du fyller i namnet. Samma blankett funkar f√∂r alla." },
            { id: 710, type: "boss", cat: "Script Activity", icon: "üìú", q: "K√∂ra T-SQL?", scenario: "Du beh√∂ver k√∂ra en 'TRUNCATE TABLE' i Warehouset innan laddning.", opts: ["Stored Procedure Activity", "Script Activity", "Lookup Activity", "Notebook"], correct: 1, senior: "Script Activity √§r den moderna ers√§ttaren f√∂r Stored Proc activity. Den kan k√∂ra T-SQL (NonQuery och Query) direkt mot Warehouse/SQL.", grandma: "Skicka ett SMS (Script) med ordern 'T√∂m lagret'. Enkelt och snabbt." },
            { id: 711, type: "code", cat: "Web Activity", icon: "üåê", q: "Anropa REST API?", scenario: "Du vill h√§mta valutakurser fr√•n ett externt API.", opts: ["Copy Activity", "Web Activity", "Script Activity", "Dataflow"], correct: 1, senior: "Web Activity g√∂r HTTP GET/POST anrop. Svaret kan sedan parsas i efterf√∂ljande aktiviteter.", grandma: "Ringa upp banken (Web Activity) och fr√•ga vad dollarn st√•r i." },
            { id: 712, type: "boss", cat: "Pipeline Return", icon: "‚Ü©Ô∏è", q: "Skicka v√§rde tillbaka?", scenario: "En 'Child Pipeline' r√§knar ut ett v√§rde som 'Master Pipeline' beh√∂ver.", opts: ["Set Variable", "Return Value (Set Pipeline Return Value)", "Skriv till fil", "Global Parameter"], correct: 1, senior: "Anv√§nd aktiviteten 'Set Pipeline Return Value' i slutet av Child-pipelinen f√∂r att skicka data tillbaka till anroparen.", grandma: "Springpojken kommer tillbaka och l√§mnar kvittot (Return Value) till chefen." },
            { id: 713, type: "core", cat: "Monitoring", icon: "üìä", q: "Gantt-schema?", scenario: "Du vill se exakt vilken aktivitet som tog l√§ngst tid i en pipeline-k√∂rning.", opts: ["Monitor Hub -> Gantt View", "Log Analytics", "Spark UI", "Metric App"], correct: 0, senior: "I Monitoring Hub kan du se pipeline-k√∂rningen som ett Gantt-schema, vilket visualiserar den 'kritiska linjen' och flaskhalsar.", grandma: "Tidslinjen visar vem som s√∂lar." },
            { id: 714, type: "boss", cat: "Fast Copy", icon: "‚ö°", q: "Dataflow Gen2 Prestanda?", scenario: "Dataflow Gen2 √§r l√•ngsamt p√• att skriva till Lakehouse.", opts: ["Aktivera 'Fast Copy'", "St√§ng av Staging", "√ñka Compute", "Anv√§nd Pipeline"], correct: 0, senior: "Se till att 'Require Fast Copy' √§r aktiverat i Dataflow-inst√§llningarna. Det anv√§nder V-Order och parallellisering f√∂r att skriva snabbare.", grandma: "Anv√§nd expressfilen (Fast Copy) ist√§llet f√∂r den vanliga k√∂n." },
            { id: 715, type: "code", cat: "Gateway", icon: "üö™", q: "On-Prem SQL?", scenario: "Pipeline ska h√§mta data fr√•n lokal server. Felmeddelande: 'Connection failed'.", opts: ["√ñppna brandv√§ggen", "Installera On-Prem Data Gateway", "Anv√§nd VPN", "Byt till Cloud"], correct: 1, senior: "F√∂r att n√• data bakom en brandv√§gg/On-Prem kr√§vs en Data Gateway (Standard eller VNET) installerad i n√§tverket.", grandma: "Du beh√∂ver en agent p√• insidan (Gateway) som kan smuggla ut datat." },
            { id: 801, type: "boss", cat: "Trusted Access", icon: "üõ°Ô∏è", q: "ADLS Gen2 Firewall?", scenario: "Du har en ADLS Gen2 med brandv√§gg p√•slagen. Ditt Fabric Workspace nekas √•tkomst via Shortcut.", opts: ["Anv√§nd Gateway", "Trusted Workspace Access", "St√§ng av brandv√§ggen", "Byt till Blob Storage"], correct: 1, senior: "F√∂r att passera en Azure-brandv√§gg utan Gateway m√•ste du anv√§nda 'Trusted Workspace Access'. Detta kr√§ver en 'Workspace Identity' som har RBAC-roll p√• lagringskontot.", grandma: "Du beh√∂ver ett VIP-pass (Workspace Identity) f√∂r att vakten (Brandv√§ggen) ska sl√§ppa in dig utan att du beh√∂ver k√∂a (Gateway)." },
            { id: 802, type: "core", cat: "Power BI Themes", icon: "üé®", q: "Standardisera f√§rger?", scenario: "Marknadschefen klagar p√• att alla rapporter har olika bl√• nyanser. Hur l√∂ser du detta skalbart?", opts: ["Mall-fil (.pbit)", "JSON Theme File", "PowerPoint bakgrund", "CSS"], correct: 1, senior: "Ladda upp en Custom Theme (JSON) till Power BI. Detta tvingar alla visuella element att f√∂lja f√∂retagets f√§rgpalett och typsnitt automatiskt.", grandma: "Ge alla samma m√•larbok. D√• spelar det ingen roll vem som m√•lar, det ser √§nd√• enhetligt ut." },
            { id: 803, type: "core", cat: "Admin Roles", icon: "üëÆ", q: "Vem √∂vervakar Kapacitet?", scenario: "En konsult ska optimera CU-anv√§ndningen men ska INTE kunna se eller √§ndra data i workspacerna.", opts: ["Fabric Admin", "Capacity Administrator", "Workspace Admin", "Member"], correct: 1, senior: "Capacity Administrator har full insyn i Metrics App och skalning, men ger ingen automatisk √•tkomst till inneh√•llet i workspacerna som ligger p√• kapaciteten.", grandma: "Vaktm√§staren (Capacity Admin) ser till att elen funkar i huset, men han har inte nyckel till l√§genheterna." },
            { id: 804, type: "boss", cat: "Migration Switch", icon: "switch", q: "Synapse Migration?", scenario: "Du f√∂rs√∂ker migrera ett Synapse Dedicated Pool till Fabric DW men alternativet √§r utgr√•at eller saknas.", opts: ["Capacity Setting", "Workspace Setting", "Tenant Setting", "Kr√§ver Support Ticket"], correct: 2, senior: "M√∂jligheten att anv√§nda specifika migreringsverktyg (som Synapse till Fabric) styrs ofta av en 'Tenant Setting' i Admin Portal som m√•ste sl√•s p√• f√∂rst.", grandma: "Du kan inte k√∂ra in p√• den nya v√§gen f√∂rr√§n kommunen (Admin) har tagit bort avsp√§rrningen (Tenant Setting)." }
        ];

        // ==========================================
        //  ENGINE START
        // ==========================================
        function init() {
            const navContainer = document.querySelector('.flex.gap-6.text-sm');
            if(!document.getElementById('nav-exam')) {
                const examBtn = document.createElement('button');
                examBtn.id = 'nav-exam';
                examBtn.onclick = () => startExamMode();
                examBtn.className = "hover:text-white transition py-2 text-red-400";
                examBtn.innerText = "EXAM MODE ‚è±Ô∏è";
                navContainer.insertBefore(examBtn, document.getElementById('nav-coach'));
            }
            setMode('all');
            applyLanguage();
            renderCodex(); 
            renderCheatSheet();
            updateStatsUI();
        }

        // --- SMART SHUFFLE ALGORITHM ---
        function smartShuffle(deck) {
            const weightedDeck = [];
            deck.forEach(q => {
                const weight = 1 + (state.mistakes[q.id] || 0) * 5;
                for(let i=0; i<weight; i++) {
                    weightedDeck.push(q);
                }
            });
            weightedDeck.sort(() => Math.random() - 0.5);
            return [...new Set(weightedDeck)];
        }

        function switchView(viewName) {
            state.view = viewName;
            const views = ['simulator', 'codex', 'cheatsheet', 'coach'];
            views.forEach(v => {
                const el = document.getElementById(`view-${v}`);
                if(el) el.classList.add('hidden');
                const nav = document.getElementById(`nav-${v === 'cheatsheet' ? 'cheat' : v === 'simulator' ? 'sim' : v}`);
                if(nav) nav.className = (v === 'coach') ? "hover:text-white transition py-2 flex items-center gap-1" : "hover:text-white transition py-2";
            });
            
            if(viewName === 'exam') {
                document.getElementById('view-simulator').classList.remove('hidden');
            } else {
                const el = document.getElementById(`view-${viewName}`);
                if(el) el.classList.remove('hidden');
                const navId = viewName === 'cheatsheet' ? 'nav-cheat' : viewName === 'simulator' ? 'nav-sim' : `nav-${viewName}`;
                const navEl = document.getElementById(navId);
                if(navEl) navEl.classList.add('nav-active');
            }
            const filters = document.getElementById('sim-filters');
            if(viewName === 'simulator') filters.classList.remove('opacity-0'); else filters.classList.add('opacity-0');
        }

        function setMode(mode) {
            state.mode = mode;
            document.getElementById('label-mission').innerText = langData[state.language].label_mission;
            document.querySelectorAll('button[id^="btn-"]').forEach(b => b.className = "px-3 py-1 text-xs font-bold rounded text-stone-400 hover:text-white transition");
            const btn = document.getElementById(`btn-${mode}`);
            if(btn) {
                if(mode === 'code') btn.className = "px-3 py-1 text-xs font-bold rounded text-cyan-400 bg-cyan-900/30 border border-cyan-500 transition shadow-inner ml-1";
                else btn.className = "px-3 py-1 text-xs font-bold rounded text-amber-500 bg-white/10 transition shadow-inner";
            }
            let baseDeck = [];
            if(mode === 'all') baseDeck = [...cleanBank];
            else baseDeck = cleanBank.filter(q => q.type === mode);
            state.activeDeck = smartShuffle(baseDeck);
            state.currentIndex = 0;
            loadQuestion();
        }

        function startExamMode() {
            switchView('exam');
            state.mode = 'exam';
            const shuffled = [...cleanBank].sort(() => Math.random() - 0.5);
            state.activeDeck = shuffled.slice(0, 50);
            state.currentIndex = 0;
            examState = { answers: [], timer: 0, interval: null };
            document.getElementById('sim-filters').classList.add('opacity-0');
            document.getElementById('label-mission').innerText = "EXAM SESSION";
            if(examState.interval) clearInterval(examState.interval);
            examState.interval = setInterval(() => {
                examState.timer++;
            }, 1000);
            loadQuestion();
        }

        function loadQuestion() {
            const data = state.activeDeck[state.currentIndex];
            const t = langData[state.language];
            state.attemptsLeft = 3; state.isLocked = false;
            document.getElementById('nav-overlay').classList.add('hidden');
            ['lock-overlay-a', 'lock-overlay-b'].forEach(id => document.getElementById(id).style.opacity = '1');
            ['content-answer', 'content-grandma'].forEach(id => { 
                const el = document.getElementById(id); 
                el.classList.remove('unlocked'); 
                el.classList.add('locked-blur'); 
                el.innerHTML = ''; 
            });

            let optsHtml = '';
            data.opts.forEach((o, i) => {
                const letter = ['A', 'B', 'C', 'D'][i];
                optsHtml += `<button id="opt-${i}" onclick="handleAnswer(${i})" class="option-btn group"><div class="option-circle group-hover:bg-stone-600 transition">${letter}</div><span class="font-medium">${o}</span></button>`;
            });

            let statusHtml = `<span>ID: #${data.id}</span><span>Attempts: <span id="attempts-display">3</span></span>`;
            if(state.mode === 'exam') {
                statusHtml = `<span class="text-red-400 font-bold">Q ${state.currentIndex + 1} / 50</span><span>‚è±Ô∏è ${Math.floor(examState.timer / 60)}m ${examState.timer % 60}s</span>`;
            }

            document.getElementById('card-question').innerHTML = `
                <div class="h-full flex flex-col">
                    <div class="flex justify-between items-start mb-4"><span class="category-pill">${data.cat}</span><div class="flex gap-1">${state.mode !== 'exam' ? [1,2,3].map(n => `<div id="life-${n}" class="w-2 h-2 rounded-full bg-emerald-500"></div>`).join('') : ''}</div></div>
                    <h2 class="text-xl font-bold text-white mb-3 leading-snug">${data.q}</h2>
                    <div class="bg-stone-800/50 border-l-2 border-amber-600 p-3 rounded-r-lg mb-6"><p class="text-sm text-stone-400 italic font-mono leading-relaxed">${data.scenario}</p></div>
                    <div class="flex-grow space-y-2" id="options-container">${optsHtml}</div>
                    <div class="mt-auto pt-4 flex justify-between text-[10px] text-stone-600 font-mono uppercase">${statusHtml}</div>
                </div>`;
        }

        function handleAnswer(idx) {
            if(state.isLocked) return;
            if(state.mode === 'exam') {
                examState.answers[state.currentIndex] = idx;
                document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('bg-stone-700', 'border-amber-500'));
                const btn = document.getElementById(`opt-${idx}`);
                btn.classList.add('bg-stone-700', 'border-amber-500');
                setTimeout(() => {
                    if(state.currentIndex < 49) {
                        state.currentIndex++;
                        loadQuestion();
                    } else {
                        finishExam();
                    }
                }, 300);
                return;
            }
            const data = state.activeDeck[state.currentIndex];
            const btn = document.getElementById(`opt-${idx}`);
            if (idx === data.correct) successSequence(btn); else failSequence(btn);
        }

        function finishExam() {
            clearInterval(examState.interval);
            let score = 0;
            examState.answers.forEach((ans, i) => {
                if(ans === state.activeDeck[i].correct) score++;
            });
            const pct = Math.round((score / 50) * 100);
            const passed = pct >= 70;
            const t = langData[state.language];

            document.getElementById('card-question').innerHTML = `
                <div class="h-full flex flex-col items-center justify-center text-center">
                    <div class="text-6xl mb-4">${passed ? 'üèÜ' : 'üíÄ'}</div>
                    <h2 class="text-3xl font-black text-white mb-2">${passed ? t.exam_pass : t.exam_fail}</h2>
                    <p class="text-stone-400 mb-6">${t.exam_score} <span class="${passed ? 'text-emerald-400' : 'text-red-400'} font-bold text-xl">${pct}%</span> (${score}/50)</p>
                    <button onclick="setMode('all')" class="bg-amber-600 text-black font-bold py-3 px-8 rounded-full hover:bg-amber-500 transition">EXIT EXAM</button>
                </div>
            `;
        }

        function successSequence(btn) {
            state.isLocked = true; state.score += (state.attemptsLeft * 10); state.streak++; saveData(); updateStatsUI();
            btn.classList.add('correct-answer');
            confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
            document.getElementById('options-container').classList.add('disabled-opts');
            revealIntel();
            document.getElementById('nav-overlay').classList.remove('hidden');
        }

        function failSequence(btn) {
            const qId = state.activeDeck[state.currentIndex].id;
            state.mistakes[qId] = (state.mistakes[qId] || 0) + 1; 
            saveData();
            state.attemptsLeft--; state.streak = 0; updateStatsUI();
            btn.classList.add('wrong-answer');
            setTimeout(() => btn.classList.remove('wrong-answer'), 500);
            btn.classList.add('opacity-50', 'pointer-events-none');
            document.getElementById(`life-${state.attemptsLeft + 1}`).className = "w-2 h-2 rounded-full bg-stone-700";
            document.getElementById('attempts-display').innerText = state.attemptsLeft;
            if(state.attemptsLeft <= 0) {
                state.isLocked = true;
                document.getElementById(`opt-${state.activeDeck[state.currentIndex].correct}`).classList.add('correct-answer', 'ring-2', 'ring-white');
                revealIntel();
                document.getElementById('nav-overlay').classList.remove('hidden');
            }
        }

        function revealIntel() {
            const data = state.activeDeck[state.currentIndex];
            const t = langData[state.language];
            let ansHtml = '';
            data.opts.forEach((o, i) => { if(i === data.correct) ansHtml += `<div class="p-3 bg-emerald-900/30 border border-emerald-500/50 rounded-lg flex items-center gap-3 mb-2"><div class="text-emerald-500 font-bold">‚úì</div><div class="text-sm font-bold text-white font-mono">${o}</div></div>`; });
            
            document.getElementById('content-answer').innerHTML = `<div class="mb-4"><span class="category-pill bg-emerald-900 text-emerald-400 border-emerald-700">${t.label_solution}</span></div><div class="mb-6">${ansHtml}</div><div class="bg-black border border-amber-900/50 p-4 rounded-xl shadow-lg mt-auto relative overflow-hidden"><div class="absolute -right-2 -top-2 text-6xl opacity-10">üí°</div><p class="text-[10px] text-amber-500 font-bold uppercase tracking-widest mb-2">${t.label_senior}</p><p class="text-sm text-stone-300 font-medium leading-relaxed">${data.senior}</p></div>`;
            document.getElementById('content-grandma').innerHTML = `<div class="text-6xl mb-6 animate-bounce">üß†</div><h3 class="text-amber-500 font-serif italic text-lg mb-6">"${t.label_grandma}"</h3><p class="text-white text-lg font-medium leading-relaxed px-2">"${data.grandma}"</p>`;

            ['lock-overlay-a', 'lock-overlay-b'].forEach(id => document.getElementById(id).style.opacity = '0');
            ['content-answer', 'content-grandma'].forEach(id => { const el = document.getElementById(id); el.classList.remove('locked-blur'); el.classList.add('unlocked'); });
            setTimeout(() => document.getElementById('card-answer').scrollIntoView({ behavior: 'smooth', block: 'center' }), 500);
        }

        function nextQuestion() {
            if(state.currentIndex < state.activeDeck.length - 1) {
                state.currentIndex++;
                loadQuestion();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else {
                alert("Deck Complete! Shuffling based on mistakes...");
                setMode(state.mode); 
            }
        }

        function prevQuestion() {
            if(state.currentIndex > 0) {
                state.currentIndex--;
                loadQuestion();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function updateStatsUI() {
            document.getElementById('score-display').innerText = state.score;
            document.getElementById('streak-display').innerText = state.streak;
        }

        function saveData() { localStorage.setItem('dp600_atlas_ultimate_v2', JSON.stringify({ score: state.score, streak: state.streak, apiKey: state.apiKey, language: state.language, mistakes: state.mistakes })); }
        function resetProgress() { if(confirm("Reset Stats?")) { state.score = 0; state.streak = 0; state.mistakes = {}; saveData(); updateStatsUI(); init(); } }

        function applyLanguage() {
            const t = langData[state.language];
            const btn = document.getElementById('lang-btn');
            btn.innerHTML = state.language === 'sv' ? 'üá∏üá™' : 'üá∫üá∏';
            document.getElementById('nav-sim').innerText = t.nav_sim;
            document.getElementById('nav-codex').innerText = t.nav_codex;
            document.getElementById('nav-cheat').innerText = t.nav_cheat;
            document.getElementById('btn-all').innerText = t.btn_all;
            document.getElementById('btn-core').innerText = t.btn_core;
            document.getElementById('btn-boss').innerText = t.btn_boss;
            document.getElementById('btn-code').innerText = t.btn_code;
            document.getElementById('label-intel').innerText = t.label_intel;
            document.getElementById('label-strategy').innerText = t.label_strategy;
            document.getElementById('btn-next').innerHTML = `${t.btn_next} <span>‚Üí</span>`;
            document.getElementById('btn-ai-gen').innerHTML = `<span>‚ú®</span> ${t.btn_ai_gen}`;
            document.getElementById('coach-subtitle').innerText = t.coach_sub;
            document.getElementById('coach-welcome').innerHTML = t.coach_wel;
            document.getElementById('chat-input').placeholder = t.coach_ph;
            document.getElementById('codex-subtitle').innerText = t.codex_sub;
            document.getElementById('cheat-subtitle').innerText = t.cheat_sub;
            if(state.mode !== 'exam') document.getElementById('label-mission').innerText = t.label_mission;
            
            renderCodex();
            renderCheatSheet();
            if(state.activeDeck.length > 0 && state.mode !== 'exam') loadQuestion();
        }

        function toggleLanguage() {
            state.language = state.language === 'sv' ? 'en' : 'sv';
            saveData();
            applyLanguage();
        }

        function openApiModal() { document.getElementById('api-modal').style.display = 'flex'; }
        function closeApiModal() { document.getElementById('api-modal').style.display = 'none'; }
        function saveApiKey() { const key = document.getElementById('api-key-input').value.trim(); if(key) { state.apiKey = key; saveData(); closeApiModal(); alert("API Key Saved!"); } }
        async function callGemini(prompt) {
            if(!state.apiKey) { openApiModal(); return null; }
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${state.apiKey}`;
            try {
                const response = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] }) });
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (error) { console.error("Gemini Error:", error); alert("Error calling Gemini API."); return null; }
        }
        async function sendChatMessage() {
            const input = document.getElementById('chat-input');
            const msg = input.value.trim();
            if(!msg) return;
            const container = document.getElementById('chat-messages');
            container.innerHTML += `<div class="msg msg-user">${msg}</div>`;
            input.value = '';
            container.scrollTop = container.scrollHeight;
            const typingId = 'typing-' + Date.now();
            container.innerHTML += `<div id="${typingId}" class="msg msg-ai"><span class="typing-dot"></span><span class="typing-dot"></span><span class="typing-dot"></span></div>`;
            container.scrollTop = container.scrollHeight;
            const langInstr = state.language === 'sv' ? "Respond in Swedish." : "Respond in English.";
            const systemPrompt = `You are Atlas, a senior data architect for DP-600. Use 'Grandma rules' (analogies) and 'Senior Tips'. Keep answers concise. ${langInstr}`;
            const fullPrompt = `${systemPrompt}\n\nUser: ${msg}\nAtlas:`;
            const reply = await callGemini(fullPrompt);
            document.getElementById(typingId).remove();
            if(reply) container.innerHTML += `<div class="msg msg-ai">${marked.parse(reply)}</div>`; else container.innerHTML += `<div class="msg msg-ai text-red-400">Connection failed.</div>`;
            container.scrollTop = container.scrollHeight;
        }
        function handleEnter(e) { if(e.key === 'Enter') sendChatMessage(); }
        async function generateAIQuestion() {
            const btn = document.getElementById('btn-ai-gen');
            const originalText = btn.innerHTML;
            btn.innerHTML = `<span>‚è≥</span> ...`;
            btn.disabled = true;
            const langInstr = state.language === 'sv' ? "in Swedish (but keep technical terms in English)" : "in English";
            const prompt = `Generate a unique multiple-choice question for DP-600 exam. Format as JSON: { "q": "Question text", "scenario": "Scenario text", "opts": ["Option A", "Option B", "Option C", "Option D"], "correct": 0-3 (index), "senior": "Technical explanation ${langInstr}", "grandma": "Simple analogy ${langInstr}" }. Topic: Advanced Fabric Analytics. Response MUST be valid JSON only.`;
            const jsonStr = await callGemini(prompt);
            if(jsonStr) {
                try {
                    const cleanJson = jsonStr.replace(/```json|```/g, '').trim();
                    const qData = JSON.parse(cleanJson);
                    qData.id = 999; qData.cat = "AI Generated ‚ú®"; qData.type = "boss"; qData.icon = "ü§ñ";
                    state.activeDeck.splice(state.currentIndex + 1, 0, qData);
                    nextQuestion();
                } catch(e) { console.error(e); alert("AI Error. Try again."); }
            }
            btn.innerHTML = originalText;
            btn.disabled = false;
        }

        init();
    </script>
</body>
</html>
